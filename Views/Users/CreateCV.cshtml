@using TuvVision.Models;
@model TuvVision.Models.Users
@{
    ViewBag.Title = "CreateCV";
    Layout = "~/Views/Shared/_TuvVision.cshtml";

}

<title>Create CV</title>
@{
    string roleName = Session["RoleName"]?.ToString();
}


<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" crossorigin="anonymous"></script>

<script src="~/AllJsAndCss/moment-precise-range.js"></script>

<!--  required libraries  -->
@*DATEPICKER*@

<script type="text/javascript" src="../../Scripts/jquery-1.5.1.min.js"></script>

<script src="https://cdn.ckeditor.com/4.6.0/full/ckeditor.js"></script>

@*DATEPICKER*@
@*<script src="https://code.jquery.com/jquery-1.10.2.js"></script>*@
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />


<!--filepond-->
<link href="~/AllJsAndCss/css/filepond.css" rel="stylesheet" />

<style>
    .ui-widget-header {
        background: #001ED2 !important;
    }

    .ui-datepicker-month, .ui-datepicker-year {
        color: #333 !important;
    }

    .ui-widget-header {
        background: #001ED2 !important;
    }

    .ui-datepicker-month, .ui-datepicker-year {
        color: #333 !important;
    }

    .NoBorder {
        border: none;
        background-color: white;
    }

    .addCSS {
        pointer-events: none;
    }

    .PersonalInfo {
        width: 400px;
    }

    hr {
        border: none;
        border-top: 2px solid #000;
    }

    @@media print {
        .pagebreak {
            page-break-before: always;
        }
    }

    table tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    table tr:hover {
        background-color: #ddd;
    }

    table td, table th {
        border: 1px solid #ddd;
        padding: 8px;
    }

    table th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #001ED2;
        color: white;
    }

    #preloader {
        position: fixed;
        width: 100%;
        height: 100vh;
        background: #fff url('../../Content/Loader/loader.gif') no-repeat center center;
        z-index: 9999;
        /*background: url('../../Content/Loader/loader.gif')no-repeat center center;*/
    }

    .col-md-12 {
        width: 103%;
    }
</style>

<script>
    $(function () {
        $(".datepicker").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"
        });
    });

    function isAlphaNumeric(e) {
        var keyCode = e.keyCode || e.which;

        var regex = /^[A-Za-z0-9,\s]+$/;

        var isValid = regex.test(String.fromCharCode(keyCode));
        if (!isValid) {
            e.preventDefault();
            alert("Only Alphabets and Numbers allowed.");
        }

        return isValid;
    };

</script>


@using (Html.BeginForm())
{

    @Html.AntiForgeryToken()
     <!--Start of main content 3-->
    <div class="grey-bg-f3">
        <!--Start of header-->
        <div class="container-fluid">
            <div class="row assignfixedwidth rp-5">

                <div class="col-xs-12 form-col">
                    <div class="row">

                        <div class="col-xs-12 text-right">
                            <a href="@Url.Action("CreateUser", "Users")" class="btn btn-info dynamic-function-btn"><i class="fa fa-long-arrow-left"></i> Go Back</a>
                        </div>

                        <div class="col-xs-12">
                            <div class="white-bg section-box-shadow">
                                @if (Model != null)
                                {
                                    if (Model.PK_UserID != "" && Model.PK_UserID != null)
                                    {
                                        <h3 class="form-page-title">Update CV</h3>
                                    }
                                    else
                                    {
                                        <h3 class="form-page-title">Insert CV</h3>
                                    }
                                }
                                else
                                {
                                    <h3 class="form-page-title">Insert CV</h3>
                                }
                               
                                <div class="row">
                                    <div class="col-xs-12 col-sm-offset-1 col-sm-10">
                                        <div class="form-box">
                                            <form>
                                                <div class="col-xs-12 col-sm-12" style="margin-left:-13px;">
                                                    <span>
                                                        <strong style="color:#E12F24;">Notes </strong>
                                                    </span>: 1) <span style="color:#E12F24;font-size:20px;">*</span> - Mandatory.<br />
                                                    <span>
                                                        <strong style="color:#E12F24;"></strong>
                                                    </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2) After updating your CV, please click the “Download” button to ensure the data is saved in the system.<br />
                                                    <hr>
                                                  </div>
                                               
                                                <br />
                                                
                                                      <div>
                                                          
                                                        <label class="heading">
                                                            <h4><b>Personal information:</b></h4>
                                                        </label>
                                                    </div>
                                                    <div class="row">

                                                        <div class="col-md-8">
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Name</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-7" style="float:left !important">
                                                                    @*<span>@Model</span>*@
                                                                    <input type="text" id="Name" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.FullName.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Date of Birth</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@DoB</span>*@
                                                                    <input type="text" id="DOB" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.DOB.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Age</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@Age</span>*@
                                                                    <input type="text" id="Age" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.AgeCalculator.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Nationality</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@Nationality</span>*@
                                                                    <input type="text" id="Nationality" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.nationalities.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Location</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@Location</span>*@
                                                                    <input type="text" id="Location" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.Location.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Gender</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@Gender</span>*@
                                                                    <input type="text" id="Gender" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.Gender.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Marital Status</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@MaritalStatus</span>*@
                                                                    <input type="text" id="MaritalStatus" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.Marital_Status.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Languages</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <input type="text" id="Languages" class="PersonalInfo NoBorder" disabled="disabled" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>TUV India DOJ</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@TUVDOJ</span>*@
                                                                    <input type="text" id="TUVDOJ" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.DateOfJoining.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Exp. with TUV India</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@ExpTUV</span>*@
                                                                    <input type="text" id="ExpTUV" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.TUVTotalyearofExperience.ToString()" />
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-bottom:1px">
                                                                <div class="col-md-3">
                                                                    <label>
                                                                        <b>Total Experience</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <label>
                                                                        <b>:</b>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    @*<span>@TotalExp</span>*@
                                                                    <input type="text" id="TotalExp" class="PersonalInfo NoBorder" disabled="disabled" value="@Model.TotalyearofExprience.ToString()" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            @if (Model.StrIData == null || Model.StrIData == string.Empty)
                                                            {
                                                                <img src="~/Content/SIGN/NoImage.jpg" style="height: 220px;width: 190px;float:right" />

                                                            }
                                                            else
                                                            {

                                                                @*<img src="data:image/jpg;base64,@Convert.ToBase64String(Model.IData)" height="75px" width="75px" />*@
                                                                <img src="~/content/Sign/@Model.StrIData.ToString()" style="height: 220px;width: 190px;float:right" />
                                                            }
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <div>
                                                        <label class="heading">
                                                            <h4><b>Educational Qualification (s):</b></h4>
                                                        </label>
                                                    </div>
                                                    @*<div class="row">@EducationalQualification</div><hr>*@
                                                    <div class="EducationalQualification">
                                                        @if (ViewBag.lstDOrderType != null)
                                                        {
                                                            if (ViewBag.lstDOrderType.Count != 0)
                                                            {
                                                                foreach (var item in ViewBag.lstDOrderType as IEnumerable<TuvVision.Models.Users>)
                                                                {
                                                                    string Degree = "";
                                                                    //if (@item.Degree = "BEng") { Degree = ""} else if()
                                                                    if (item.Degree == "BEng")
                                                                    {
                                                                        Degree = "Bachelor of Engineering";
                                                                    }
                                                                    else if (item.Degree == "BTech") { Degree = "Bachelor of Technology"; }
                                                                    else if (item.Degree == "BA") { Degree = "Bachelor of Arts"; }
                                                                    else if (item.Degree == "BSc") { Degree = "Bachelor of Science"; }
                                                                    else if (item.Degree == "BCom") { Degree = "Bachelor of Commerce"; }
                                                                    else if (item.Degree == "Tech") { Degree = "Technical"; }
                                                                    else if (item.Degree == "NTech") { Degree = "Non Technical"; }
                                                                    else if (item.Degree == "ME") { Degree = "Master of Engineering"; }
                                                                    else
                                                                    {
                                                                        Degree = item.Degree;
                                                                    }
                                                                    string University = item.UniversityName;
                                                                    string Course = item.Course;
                                                                    string YearOfPassing = item.YearOfPassing;
                                                                    string MajorFieldOfStudy = item.MajorFieldOfStudy;

                                                                    <p>@YearOfPassing - @Course @Degree in @MajorFieldOfStudy from Institute/University - @University.</p>
                                                                }
                                                            }
                                                        }

                                                    </div><hr>
                                                    <div>
                                                        <label class="heading">
                                                            <h4><b>Professional Qualification (s):</b></h4>
                                                        </label>
                                                    </div>
                                                    @*<div class="row">@ProfessionalQualification</div><hr>*@
                                                    <div class="ProfessionalQualification">
                                                        @if (ViewBag.lstProfCerts != null)
                                                        {
                                                            if (ViewBag.lstProfCerts.Count != 0)
                                                            {
                                                                foreach (var item in ViewBag.lstProfCerts as IEnumerable<TuvVision.Models.Users>)
                                                                {
                                                                    string Certification = item.CertName;
                                                                    string validTill = item.CertValidTill;

                                                                    <p>@Certification (Valid till @validTill)</p>
                                                                }
                                                            }
                                                        }
                                                    </div><hr>
                                                                <div>

                                                                    <label class="heading">
                                                                        <h4><b>TUVI NDT Level II Certification (s):</b></h4>
                                                                    </label>
                                                                </div>
                                                            @*<div class="row">@ProfessionalQualification</div><hr>*@
                                                            <div class="ProfessionalQualification">
                                                                @if (ViewBag.LstNdt != null)
                                                                {
                                                                    if (ViewBag.LstNdt.Count != 0)
                                                                    {
                                                                        foreach (var item in ViewBag.LstNdt as IEnumerable<TuvVision.Models.Users>)
                                                                        {
                                                                            string Certification = item.Method;
                                                                            string validTill = item.CertValidDate;

                                                                            <p>@Certification (Valid till @validTill)</p>
                                                                        }
                                                                    }
                                                                }
                                                            </div><hr>
                                                    <div>
                                                        <input type="checkbox" id="ChkInspection" name="ChkInspection" hidden value="Yes" style="margin-right: 10px;" @(Model.IsInspectionCheck ? "checked" : "")>
                                                        <label class="heading">
                                                            <h4><b>Core Competency in Inspection/Assessment of <span style="color:red">(Tick if below data to be printed on CV)</span>:</b></h4>
                                                        </label>
                                                        <input type="button" value="Fetch Data from TCE" onclick="RefetchInspectionData()" class="btn btn-primary" style="margin-left: 10px;">
                                                    </div>
                                                    <div class="col-md-12 hrafter">
                                                        <textarea id="Inspection" class="form-control RemoveBorder" style="width: 100%;height: 80px;resize: none;margin-left: -15px;" onkeypress="isAlphaNumeric(event)">@Model.Inspection.ToString()</textarea>
                                                    </div>
                                                    <hr style="margin-top: 95px;">
                                                    @*<div>*@
                                                    <div class="pagebreak">
                                                        <label class="heading">
                                                            <h4><b>Summary of Expertise:</b><span style="color:#E12F24;font-size:20px;">*</span></h4>
                                                        </label><div class="col-md-12" style="margin-left: -13px;">
                                                            <textarea id="ExpertiseSummary" class="form-control RemoveBorder" style="width: 100%;height: 80px;resize: none;margin-left: -15px;" onkeypress="isAlphaNumeric(event)">@Model.ExpertiseSummary.ToString()</textarea>
                                                        </div>
                                                    </div><hr style="margin-top: 290px;">
                                                    <label class="heading">
                                                        <h4><b>Work Experience:</b></h4>
                                                    </label>
                                                    <div class="col-md-12 row DownloadHide">
                                                        <div class="col-md-4">
                                                            <label>Period From</label>
                                                            <input id="txtPeriodFrom" msg="Period" class="form-control Emp datepicker" />
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label>Period To</label>
                                                            <input id="txtPeriodTo" msg="Period" class="form-control datepicker" />
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label>Employer Name</label>
                                                            <input id="txtEmployerName" msg="Employer Name" class="form-control Emp" />
                                                        </div>

                                                    </div>
                                                    <div class="col-md-12 row DownloadHide" style="margin-bottom:20px">
                                                        @*<div class="col-md-4">
                                                            <label>Designation</label>
                                                            <input id="txtDesignation" msg="Designation" class="form-control Emp" />
                                                        </div>*@
                                                        <div class="col-md-4">
                                                            <label>Location</label>
                                                            <input id="txtLocation" msg="Location" class="form-control Emp" value="@Model.Location.ToString()" />
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label>Designation</label>
                                                            <input id="txtDesignation" msg="Designation" class="form-control Emp" />
                                                        </div>
                                                        <div class="col-md-11">
                                                            <label>Responsibilities<span style="color:#E12F24;font-size:20px;">*</span></label>
                                                            @*<input id="txtResponsibilities" msg="Responsibilities" class="form-control Emp" />*@
                                                            <textarea id="txtResponsibilities" msg="Responsibilities" class="form-control" style="height:200px; resize:none"></textarea>
                                                            @*<div id="txtDesignation" msg="Designation" class="form-control Emp text-area" contenteditable="true" ></div>*@
                                                        </div>
                                                        <div class="col-md-1">
                                                            @*<button class="btn btn-primary" style="margin-top: 25px" id="AddEmployment" onclick="AddEmploymentDetails()">Add</button>*@
                                                            <input type="button" class="btn btn-primary" style="margin-top: 150px" id="AddEmployment" onclick="AddEmploymentDetails()" value="Add" />
                                                            <input type="button" class="btn btn-primary" style="visibility: hidden;" id="UpdateEmployment" onclick="UpdateEmploymentDetails()" value="Update" />
                                                        </div>
                                                    </div>
                                                    <table id="EmpTable" cellpadding="1" cellspacing="1" border="1" width="100%" hidden>
                                                        <thead id="EmpHead">
                                                            <tr>
                                                                <th>Period</th>
                                                                <th>Employer Name</th>
                                                                <th>Location</th>
                                                                <th>Designation</th>
                                                                <th hidden>Responsibilities</th>
                                                                <th>Edit</th>
                                                                <th>Delete</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="EmpBody">
                                                            @if (ViewBag.lstEmployment != null)
                                                            {
                                                                <script>
                                                                    $(document).ready(function () {
                                                                        $('#EmpTable').removeAttr("hidden");
                                                                        $('#EmpHR').css('margin-top', '15px');
                                                                        $('#txtEmployerName').removeAttr('disabled');
                                                                        $('#txtLocation').removeAttr('disabled');
                                                                    });
                                                                </script>

                                                                if (ViewBag.lstEmployment.Count != 0)
                                                                {
                                                                    int count = 1;
                                                                    foreach (var item in ViewBag.lstEmployment as IEnumerable<TuvVision.Models.Employment>)
                                                                    {
                                                                        <tr id="@("Emp" + count)">
                                                                            <td> @item.Period </td>
                                                                            <td> @item.EmployerName </td>
                                                                            <td> @item.Location </td>
                                                                            <td> @item.Designation </td>
                                                                            <td hidden> @item.Responsibilities </td>
                                                                            <td> <input type="button" class="btn btn-primary" value="Edit" onclick="EditEmployment('@("Emp" + count)')" /> </td>
                                                                            @if (count == 1)
                                                                            {
                                                                                <td></td> }
                                                                            else
                                                                            {
                                                                                <td> <input type="button" class="btn btn-primary" value="Delete" onclick="DeleteEmployment('@("Emp" + count)')" /></td>}
                                                                        </tr>
                                                                        count = count + 1;
                                                                    }
                                                                }
                                                            }
                                                        </tbody>
                                                    </table>
                                                    <hr id="EmpHR" style="margin-top: 150px;">

                                                    <label class="heading">
                                                        <h4><b>Major Achievement:</b></h4>
                                                    </label>
                                                    <div class="col-md-12 row DownloadHide">
                                                        <div class="col-md-3">
                                                            <label>Achievement Date</label>
                                                            <input id="txtAchievementDate" msg="Achievement Date" class="form-control Achievement datepicker" />
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label>Description</label>
                                                            <input id="txtDescription" msg="Achievement Description" class="form-control Achievement" />
                                                        </div>

                                                        <div class="col-md-1">

                                                            <input type="button" class="btn btn-primary" style="margin-top: 25px" id="AddAchievement" onclick="AddAchievementDetails()" value="Add" />
                                                            <input type="button" class="btn btn-primary" style="visibility: hidden;margin-top: -50px;" id="UpdateAchievement" onclick="UpdateAchievementDetails()" value="Update" />
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <table id="AchievementTable" cellpadding="1" cellspacing="1" border="1" width="100%">
                                                            <thead id="AchievementHead">
                                                                <tr>
                                                                    <th>Achievement Date</th>
                                                                    <th>Description</th>
                                                                    <th>Edit</th>
                                                                    <th>Delete</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="AchievementBody">
                                                                @if (ViewBag.lstCustomerAppreciation != null)
                                                                {
                                                                    if (ViewBag.lstCustomerAppreciation.Count != 0)
                                                                    {
                                                                        int count = 1;
                                                                        foreach (var item in ViewBag.lstCustomerAppreciation as IEnumerable<TuvVision.Models.CustomerAppreciation>)
                                                                        {
                                                                            <tr id="@("Achieve" + count)">
                                                                                <td> @item.AchievementDate </td>
                                                                                <td> @item.Description </td>
                                                                                <td> <input type="button" class="btn btn-primary" value="Edit" onclick="EditAchievement('@("Achieve" + count)')" /></td>
                                                                                <td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteAchievement('@("Achieve" + count)')" /></td>
                                                                            </tr>
                                                                            count = count + 1;
                                                                        }
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <hr id="AchieveHR">
                                                    <label class="heading">
                                                        <h4><b>Major Projects/Assignment Handled Details:</b></h4>
                                                    </label>
                                                    <div class="col-md-12 row DownloadHide">
                                                        <div class="col-md-3">
                                                            <label>Item Details<span style="color:white">Activity and Item Ispected</span></label>
                                                            <textarea id="txtActivityInspected" msg="Item Details" style="width: 210px;height: 200px;" class="form-control Project"></textarea>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>Code / Standard / Specification / MOC</label>
                                                            <textarea id="txtCodes" msg="Code / Standard / Spec. / MOC" style="width: 210px;height: 200px;" class="form-control Project"></textarea>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>Customer / End Customer / Project Name</label>
                                                            <textarea id="txtProject" msg="Customer / End Customer / Project Name" style="width: 210px;height: 200px;" class="form-control Project"></textarea>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <label>Manufacturer Name and Location</label>
                                                            <textarea id="txtEndUser" msg="Manufacturer Name and location" style="width: 135px;height: 200px;" class="form-control Project"></textarea>
                                                        </div>

                                                        <div class="col-md-1">

                                                            <input type="button" class="btn btn-primary" style="margin-top: 130px" id="AddProject" onclick="AddProjectDetails()" value="Add" />
                                                            <input type="button" class="btn btn-primary" style="visibility: hidden;margin-top: -50px;" id="UpdateProject" onclick="UpdateProjectDetails()" value="Update" />
                                                        </div>
                                                    </div>
                                                    <table id="ProjectTable" cellpadding="1" cellspacing="1" border="1" width="100%" hidden>
                                                        <thead id="ProjectHead">
                                                            <tr>
                                                                <th name="ActivityItemInspected">Item Details</th>
                                                                <th name="Codes">Code / Standard / Spec. / MOC</th>
                                                                <th name="Project">Customer / End Customer / Project Name</th>
                                                                <th name="EndUserName">Manufacturer Name and Location</th>
                                                                <th name="Edit">Edit</th>
                                                                <th name="Delete">Delete</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="ProjectBody">
                                                            @if (ViewBag.lstProject != null)
                                                            {
                                                                <script>
                                                                    $(document).ready(function () {
                                                                        $('#ProjectTable').removeAttr("hidden");
                                                                        $('#ProjectHR').css('margin-top', '15px');
                                                                    });
                                                                </script>

                                                                if (ViewBag.lstProject.Count != 0)
                                                                {
                                                                    int count = 1;
                                                                    foreach (var item in ViewBag.lstProject as IEnumerable<TuvVision.Models.ProjectCS>)
                                                                    {
                                                                        <tr id="@("Proj" + count)">
                                                                            <td> @item.ActivityItemInspected </td>
                                                                            <td> @item.Codes </td>
                                                                            <td> @item.Project </td>
                                                                            <td> @item.EndUserName </td>
                                                                            <td> <input type="button" class="btn btn-primary" value="Edit" onclick="EditProject('@("Proj" + count)')" /></td>
                                                                            <td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteProject('@("Proj" + count)')" /></td>
                                                                        </tr>
                                                                        count = count + 1;
                                                                    }
                                                                }
                                                            }
                                                        </tbody>
                                                    </table>
                                                    <hr id="ProjectHR" style="margin-top: 150px;">
                                                    <label class="heading">
                                                        <h4><b>Skill Enhancement Training attended (Self - Arranged):</b></h4>
                                                    </label>
                                                    <div class="col-md-12 row DownloadHide">
                                                        @*<div class="col-md-4">
                    <label>Arranged By</label>
                    <select id="ddlArrangedBy" msg="Arranged By" class="form-control training">
                        <option value="0">-- Select --</option>
                        <option value="Arranged By TUVI">Arranged By TUVI</option>
                        <option value="Self-Arranged">TUV-Arranged</option>
                    </select>
                </div>*@
                                                        <div class="col-md-3">
                                                            <label>Date</label>
                                                            <input id="txtTrainingDate" msg="Training Date" class="form-control training datepicker" />
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>Hours</label>
                                                            <input type="number" id="txtTrainingHours" msg="Training Hours" min="0" class="form-control training" />
                                                        </div>
                                                        <div class="col-md-5">
                                                            <label>Topic</label>
                                                            <input id="txtTrainingTopic" msg="Training Topic" class="form-control training" />
                                                        </div>
                                                        <div class="col-md-1">
                                                            @*<button class="btn btn-primary" style="margin-top: 25px" id="AddTraining">Add</button>*@
                                                            <input type="button" class="btn btn-primary" style="margin-top: 25px" id="AddTraining" onclick="AddTrainingDetails()" value="Add" />
                                                            <input type="button" class="btn btn-primary" style="visibility: hidden;margin-top: -50px;" id="UpdateTraining" onclick="UpdateTrainingDetails()" value="Update" />
                                                        </div>
                                                    </div>
                                                    <br />
                                                    <div style="margin-top:100px" class="RemoveMargin pagebreak">
                                                        @*<div style="border: 1px solid;"><span style="margin-left:20px;margin-top: 5px;"><b>Self - Arranged</b></span></div>*@
                                                        <table id="TrainingTable" cellpadding="1" cellspacing="1" border="1" width="100%" hidden>
                                                            <thead id="TrainingHead">

                                                                <tr>
                                                                    @*<th>Arranged By</th>*@
                                                                    <th style="width: 134px;">Date</th>
                                                                    <th style="width: 81px;">Hours</th>
                                                                    <th>Topic</th>
                                                                    <th style="width: 82px;">Edit</th>
                                                                    <th style="width: 82px;">Delete</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="TrainingBody">
                                                                @if (ViewBag.lstTraining != null)
                                                                {
                                                                    <script>
                                                                        $(document).ready(function () {
                                                                            $('#TrainingTable').removeAttr("hidden");
                                                                            $('#TrainingHR').css('margin-top', '15px');
                                                                        });
                                                                    </script>

                                                                    if (ViewBag.lstTraining.Count != 0)
                                                                    {
                                                                        int count = 1;
                                                                        foreach (var item in ViewBag.lstTraining as IEnumerable<TuvVision.Models.Training>)
                                                                        {
                                                                            <tr id="@("Train" + count)">
                                                                                @*<td> @item.ArrangedBy </td>*@
                                                                                <td> @item.Date </td>
                                                                                <td> @item.Hours </td>
                                                                                <td> @item.Topic </td>
                                                                                <td> <input type="button" class="btn btn-primary" value="Edit" onclick="EditTraining('@("Train" + count)')" /></td>
                                                                                <td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteTraining('@("Train" + count)')" /></td>
                                                                            </tr>
                                                                            count = count + 1;
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <tr id="nodata"><td colspan="12">No Data Found</td></tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                        @if (roleName != "InspectionO" && roleName != "OperationO")
                                                        {
                                                            <div style="border: 1px solid"><span style="margin-left:20px;margin-top: 5px;"><b>Arranged by TUVI</b></span></div>
                                                        }
                                                        else
                                                        {

                                                        }

                                                        <table id="TUVTrainingTable" cellpadding="1" cellspacing="1" border="1" width="100%" hidden>
                                                            <thead id="TUVTrainingHead">
                                                                <tr>
                                                                    @*<th>Arranged By</th>*@
                                                                    <th>Date</th>
                                                                    <th>Hours</th>
                                                                    <th>Topic</th>

                                                                </tr>
                                                            </thead>
                                                            <tbody id="TUVTrainingBody">
                                                                @if (ViewBag.lstTUVTraining != null)
                                                                {
                                                                    if (ViewBag.lstTUVTraining.Count != 0)
                                                                    {
                                                                        <script>
                                                                            $(document).ready(function () {
                                                                                $('#TUVTrainingTable').removeAttr("hidden");
                                                                            });
                                                                        </script>

                                                                        foreach (var item in ViewBag.lstTUVTraining as IEnumerable<TuvVision.Models.Training>)
                                                                        {
                                                                            <tr>
                                                                                @*<td> @item.ArrangedBy </td>*@
                                                                                <td> @item.Date </td>
                                                                                <td> @item.Hours </td>
                                                                                <td> @item.Topic </td>

                                                                            </tr>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <tr><td colspan="12">No Data Found</td></tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>

                                                    </div>
                                                    <hr id="TrainingHR" style="margin-top: 150px;">
                                                    <div>
                                                        <input type="checkbox" id="ChkDeclaration" name="vehicle1" value="Yes" style="margin-right: 10px;">
                                                        <label class="heading">
                                                            <h4><b>Declaration:</b></h4>
                                                        </label>
                                                    </div>
                                                    <div class="col-md-12 row">
                                                        <p>
                                                            I hearby decalre that the information provided above is true and accurate to the best of my knowledge.
                                                        </p>
                                                        <p><b>@Model.FullName.ToString()</b></p>
                                                        <p>
                                                            <b>Updated on: </b><span id="CVUpdatedOn">
                                                                @if (Model.CVUpdatedOn == null)
                                                                {<span>00:00:000</span>}
                                                                else
                                                                { <span>@Model.CVUpdatedOn</span>}
                                                            </span>
                                                        </p>
                                                        <p>
                                                            <b>Downloaded on: </b><span id="CVDownloadedOn">
                                                                @if (Model.CVDownloadedOn == null)
                                                                {<span>00:00:000</span>}
                                                                else
                                                                { <span>@Model.CVDownloadedOn</span>}
                                                            </span>
                                                        </p>
                                                    </div>
                                                    <div class="col-md-12 row col-md-offset-4 DownloadHide">

                                                        <input type="button" value="Update CV" class="btn btn-primary insert-form-btn" onclick="UpdateCV()" />
                                                        <input type="button" value="Download CV" id="btnDownloadCV" class="btn btn-primary insert-form-btn" onclick="CreateAndDownloadCV()" />
                                                    </div>
</form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- /.col -->
                    </div><!-- /.row -->
                </div><!-- /.data table col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
        <!--End of header-->
    </div>
    <!--End of main content 3-->
}
@********************************************************************************Script Started Here************************************************@
<script src="~/AllJsAndCss/js/bootstrap-multiselect.js"></script>
<link href="~/AllJsAndCss/css/bootstrap-multiselect.css" rel="stylesheet" />

<script src="~/AllJsAndCss/js/filepond.js"></script>

<!-- Turn all file input elements into ponds -->

<script>
    FilePond.parse(document.body);
</script>


<script>
    $(document).ready(function () {

        var TotalEXP = localStorage.getItem('TotalEXP')
        var words = TotalEXP.split(" ");
        words.splice(-2);
        TotalEXP = words.join(" ").replace('years', 'years and');
        $('#TotalExp').val(TotalEXP);

        var language = localStorage.getItem('LangSelectedVal');
        $('#Languages').val(language);

        AgeCalculator = CalclateYearMonth($('#DOB').val())
        $('#Age').val(AgeCalculator);

        CKEDITOR.replace('txtResponsibilities', {
            toolbarGroups: [
		{
		    "name": "paragraph",
		    "groups": ["list"]
		},
            {
                "name": "basicstyles",
                "groups": ["basicstyles"]
            }],
            removeButtons: 'Strike,Subscript,Superscript,Anchor,Styles,NumberedList,Specialchar,Source,Smiley,SpecialChar,PageBreak,Iframe,Blockquote,CreateDiv,Flash,FontSize ',//,Font'
            enterMode: CKEDITOR.ENTER_BR,
            removePlugins: 'magicline',
            font_names: 'Calibri (Body)',
            font_defaultLabel: 'Calibri (Body)',
            fontSize_defaultLabel: '16'
        });

        CKEDITOR.replace('ExpertiseSummary', {
            toolbarGroups: [
		{
		    "name": "paragraph",
		    "groups": ["list"]
		},
            {
                "name": "basicstyles",
                "groups": ["basicstyles"]
            }],
            removeButtons: 'Strike,Subscript,Superscript,Anchor,Styles,NumberedList,Specialchar,Source,Smiley,SpecialChar,PageBreak,Iframe,Blockquote,CreateDiv,Flash,FontSize ',//,Font'
            enterMode: CKEDITOR.ENTER_BR,
            removePlugins: 'magicline',
            font_names: 'Calibri (Body)',
            font_defaultLabel: 'Calibri (Body)',
            fontSize_defaultLabel: '16'
        });

        CKEDITOR.on('instanceReady', function (ev) {
            ev.editor.on('paste', function (evt) {

                evt.data.dataValue = "<span style=\"font-size: 12px; font-family: 'Calibri (Body)'\" >" + evt.data.dataValue + "</span>";

            });

            ev.editor.on('pastetext', function (evt) {
                evt.data.dataValue = '<span style="font-size: 16px;font-family: \'" TNG Pro\'" ">' + evt.data.dataValue + '</span>';
            });
        });

        var forbiddenWords = ["na", "not applicable", "none"];

        $('#Inspection').on('keypress', function (e) {
            var currentValue = $(this).val() + String.fromCharCode(e.which); // Get current value of textbox
            currentValue = currentValue.toLowerCase(); // Convert to lowercase for case-insensitive comparison
            var arrayOfcurrentValue = currentValue.split(',');

            // Get the last value from the array
            var lastValue = arrayOfcurrentValue[arrayOfcurrentValue.length - 1];

            // Check if current value contains any forbidden words
            for (var i = 0; i < forbiddenWords.length; i++) {
                if (lastValue.indexOf(forbiddenWords[i]) !== -1) {
                    e.preventDefault(); // Prevent typing if forbidden word found
                    alert('Sorry, "' + forbiddenWords[i] + '" is not allowed.');
                    return false; // Stop further processing
                }
            }
        });

    })

    function CreateAndDownloadCV() {
        debugger;
        $("body").prepend('<div id="preloader"></div>');
        //var isupdateValid = UpdateCV();

        //if (isupdateValid == false) {
        //    return false;
        //}
        var Inspection = $('#Inspection').val();
        var ExpertiseSummary = CKEDITOR.instances['ExpertiseSummary'].getData();
        var IsInspectionCheck = $("#ChkInspection").is(':checked');
        var Responsibilities = CKEDITOR.instances['txtResponsibilities'].getData();
        //if (Inspection == '') {
        //    alert('Please Add Core Competency in Inspection/Assessment of');
        //    $('#preloader').remove();
        //    return false;
            

        //}

        if (ExpertiseSummary == '') {
            alert('Please Add Summary of Expertise');
            $('#preloader').remove();

            return false;
        }
        //if (Responsibilities == "") {
        //    alert('Please Add Responsibilities');
        //    $('#preloader').remove();
        //    return false;
        //}

        var EmploymentDetails = [];
        $('#EmpHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            EmploymentDetails.push(rowData);
        });
        $('#EmpBody tr').each(function (rowIndex, row) {
            debugger
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).html().replaceAll(/&lt;/g, '<').replaceAll(/&gt;/g, '>').replaceAll(/&amp;/g, '&').replaceAll(/&nbsp;/g, '\n').trim());
            });
            EmploymentDetails.push(rowData);
        });

        var ProjectDetails = [];
        $('#ProjectHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).attr('name').trim());
            });
            ProjectDetails.push(rowData);
        });
        $('#ProjectBody tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            ProjectDetails.push(rowData);
        });

        var TrainingDetails = [];
        $('#TrainingHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            TrainingDetails.push(rowData);
        });
        $('#TrainingBody tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            TrainingDetails.push(rowData);
        });

        var AchievementDetails = [];
        $('#AchievementHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            AchievementDetails.push(rowData);
        });
        $('#AchievementBody tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            AchievementDetails.push(rowData);
        });

        var NdtDetails = [];
        $('#NdtHead tr').each(function (rowIndex, row) {
            debugger;
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            NdtDetails.push(rowData);
        });
        $('#ndtData tr').each(function (rowIndex, row) {
            debugger;
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            NdtDetails.push(rowData);
        });

        $.ajax({
            url: '@Url.Action("InsertCV", "Users")',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                Inspection: Inspection,
                ExpertiseSummary: ExpertiseSummary,
                IsInspectionCheck: IsInspectionCheck,
                EmploymentDetails: EmploymentDetails,
                ProjectDetails: ProjectDetails,
                TrainingDetails: TrainingDetails,
                AchievementDetails: AchievementDetails,
                NdtDetails: NdtDetails
            }),
            async: false,
            success: function (response) {
                //if (response == true) {
                //    alert('Data Saved Successfully');
                //}
            },
            error: function (xhr, status, error) {
                // Handle error response
                alert('Something went wrong');
                $('#preloader').remove();

            }, complete: function () {
                
                //$('#preloader').remove();
            }
        });

        var TotalEXP = $('#TotalExp').val();
        var IsInspectionCheck = $("#ChkInspection").is(':checked');
        var EmploymentDetails = [];
        $('#EmpHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            EmploymentDetails.push(rowData);
        });

        $('#EmpBody tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            EmploymentDetails.push(rowData);
        });

        var ProjectDetails = [];
        $('#ProjectHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).attr('name').trim());
            });
            ProjectDetails.push(rowData);
        });

        $('#ProjectBody tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            ProjectDetails.push(rowData);
        });

        var TrainingDetails = [];
        $('#TrainingHead tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('th').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            TrainingDetails.push(rowData);
        });
        $('#TrainingBody tr').each(function (rowIndex, row) {
            var rowData = [];
            $(row).find('td').each(function (cellIndex, cell) {
                rowData.push($(cell).text().trim());
            });
            TrainingDetails.push(rowData);
        });
        $.ajax({
            url: '@Url.Action("DownloadCV", "Users")',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                language: $('#Languages').val(),
                Age: $('#Age').val(),
                TotalEXP: TotalEXP,
                Inspection: $('#Inspection').val(),
                IsInspectionCheck: IsInspectionCheck,
                ExpertiseSummary: CKEDITOR.instances['ExpertiseSummary'].getData(),
                EmploymentDetails: EmploymentDetails,
                ProjectDetails: ProjectDetails,
                TrainingDetails: TrainingDetails
            }),
            dataType: "json",
            success: function (response) {
                debugger
                $("#preloader").remove();
                if (response == true) {
                    location.href = '@Url.Action("CV","Users")';
                }
            },
            error: function (xhr, status, error) {
                // Handle error response
                $("#preloader").remove();
                alert('Something went wrong');
            }
        });
    }

    function CalclateYearMonth(joinDateStr) {
        var joinDateParts = joinDateStr.split('/');
        var joinDate = new Date(joinDateParts[2], joinDateParts[1] - 1, joinDateParts[0]);
        var currentDate = new Date();

        var yearsDiff = currentDate.getFullYear() - joinDate.getFullYear();
        var monthsDiff = currentDate.getMonth() - joinDate.getMonth();

        if (currentDate.getDate() < joinDate.getDate()) {
            monthsDiff--;
        }

        if (monthsDiff < 0) {
            yearsDiff--;
            monthsDiff += 12;
        }

        if (yearsDiff >= 0 && yearsDiff <= 9) {
            yearsDiff = '0' + yearsDiff;
        }

        if (monthsDiff >= 0 && monthsDiff <= 9) {
            monthsDiff = '0' + monthsDiff;
        }

        return (yearsDiff + ' Years and ' + monthsDiff + ' Months');
    }

    function AddEmploymentDetails() {
        debugger
        var Period = $('#txtPeriodFrom').val() + " to " + $('#txtPeriodTo').val();
        var EmployerName = $('#txtEmployerName').val();
        var Location = $('#txtLocation').val();
        var Designation = $('#txtDesignation').val();
        var Responsibilities = CKEDITOR.instances['txtResponsibilities'].getData(); //$('#txtResponsibilities').val();

        var EmpValidation = true;
        $('#txtEmployerName').removeAttr('disabled');
        $('#txtLocation').removeAttr('disabled');

        $('.Emp').each(function (i, obj) {
            if (obj.value == '' || obj.value == null || obj.value == '0') {
                var id = obj.attributes.msg.value;
                EmpValidation = false;
                alert('Please Add ' + id);
                return false;

            }
        });
        if (Responsibilities == "") {
            alert('Please Add Responsibilities');
            return false;
        }

        if (EmpValidation) {
            if (!isDateRangeValid(Period)) {
                alert("The new date range overlaps with existing records.");
                return;
            }
            count = $('#EmpBody tr').length + 1;
            $('#EmpBody').append('<tr id="Emp' + count + '"><td>' + Period + '</td><td>' + EmployerName + '</td><td>' + Location + '</td><td>' + Designation
                + '</td><td hidden>' + Responsibilities + '</td><td><input type="button" class="btn btn-primary" value="Edit" onclick="EditEmployment(\'Emp' + count
                + '\')" /></td><td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteEmployment(\'Emp' + count + '\')" /></td></tr>')
            $('#EmpTable').removeAttr('hidden');
            $('#EmpHR').css('margin-top', '15px');
            $('.Emp').val('');
            CKEDITOR.instances['txtResponsibilities'].setData('')
            $('#txtPeriodTo').val('');

            rearrangeRows();
        }
    }

    function AddProjectDetails() {
        debugger
        var Project = $('#txtProject').val();
        var ActivityInspected = $('#txtActivityInspected').val();
        var Codes = $('#txtCodes').val();
        var EndUser = $('#txtEndUser').val();

        var ProjectValidation = true;

        $('.Project').each(function (i, obj) {
            if (obj.value == '' || obj.value == null || obj.value == '0') {
                var id = obj.attributes.msg.value;
                ProjectValidation = false;
                alert('Please Add ' + id);
                return false;
            }
        });

        if (ProjectValidation) {
            count = $('#EmpBody tr').length + 1;
            $('#ProjectBody').append('<tr id="Proj' + count + '"><td>' + ActivityInspected + '</td><td>' + Codes + '</td><td>' + Project + '</td><td>' + EndUser
                + '</td><td><input type="button" class="btn btn-primary" value="Edit" onclick="EditProject(\'Proj' + count + '\')" /></td><td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteProject(\'Proj' + count + '\')" /></td></tr>');
            $('#ProjectTable').removeAttr('hidden');
            $('#ProjectHR').css('margin-top', '15px');
            $('.Project').val('');
        }
    }

    function AddTrainingDetails() {
        debugger
        //var ArrangedBy = $('#ddlArrangedBy').val();
        //var txtActivityInspected = $('#txtEmployerName').val();
        var TrainingDate = $('#txtTrainingDate').val();
        var TrainingHours = $('#txtTrainingHours').val();
        var TrainingTopic = $('#txtTrainingTopic').val();

        var TrainingValidation = true;

        $('.training').each(function (i, obj) {
            if (obj.value == '' || obj.value == null || obj.value == '0') {
                var id = obj.attributes.msg.value;
                TrainingValidation = false;
                alert('Please Add ' + id);
                return false;
            }
        });

        if (TrainingValidation) {
            //$('#TrainingBody').append('<tr><td>' + ArrangedBy + '</td><td>' + TrainingDate + '</td><td>' + TrainingHours + '</td><td>' + TrainingTopic + '</td></tr>')
            if ($('#nodata').length) {
                $('#nodata').remove();
            }
            count = $('#TrainingBody tr').length + 1;
            $('#TrainingBody').append('<tr id="Train' + count + '"><td>' + TrainingDate + '</td><td>' + TrainingHours + '</td><td>' + TrainingTopic
                + '</td><td><input type="button" class="btn btn-primary" value="Edit" onclick="EditTraining(\'Train' + count
                + '\')" /></td><td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteTraining(\'Train' + count + '\')" /></td></tr>')
            $('#TrainingTable').removeAttr('hidden');
            $('#TrainingHR').css('margin-top', '15px');
            $('.training').val('');
            //$('#ddlArrangedBy').val(0);
        }
    }

    function EditEmployment(Empid) {
        var row = $("#" + Empid);

        // Find td elements within the selected row
        var tds = row.find('td');

        // Extract values from td elements
        var Period = tds.eq(0).text().trim();
        var EmployerName = tds.eq(1).text().trim();
        var Location = tds.eq(2).text().trim();
        var Designation = tds.eq(3).text().trim();
        var Responsibilities = tds.eq(4).html().replaceAll(/&lt;/g, '<').replaceAll(/&gt;/g, '>').replaceAll(/&amp;/g, '&').replaceAll(/&nbsp;/g, '\n').trim();

        var PeriodFrom = Period.split('to')[0].trim();
        var PeriodTo = Period.split('to')[1].trim();

        $('#txtPeriodFrom').val(PeriodFrom);
        $('#txtPeriodTo').val(PeriodTo);
        $('#txtEmployerName').val(EmployerName);
        $('#txtLocation').val(Location);
        $('#txtDesignation').val(Designation);
        CKEDITOR.instances['txtResponsibilities'].setData(Responsibilities)

        if ('Emp1' == row.attr('id')) {
            $('#txtEmployerName').attr('disabled', 'disabled');
            $('#txtLocation').attr('disabled', 'disabled');
        }
        else {
            $('#txtEmployerName').removeAttr('disabled');
            $('#txtLocation').removeAttr('disabled');
        }

        localStorage.setItem('Empid', Empid);
        $('#AddEmployment').css('visibility', 'hidden');
        $('#UpdateEmployment').css('visibility', 'visible');
    }

    function UpdateEmploymentDetails() {
        var Empid = localStorage.getItem('Empid');
        var Period = $('#txtPeriodFrom').val() + " to " + $('#txtPeriodTo').val();
        var EmployerName = $('#txtEmployerName').val();
        var Location = $('#txtLocation').val();
        var Designation = $('#txtDesignation').val();
        var Responsibilities = CKEDITOR.instances['txtResponsibilities'].getData();

        var EmpValidation = true;

        $('.Emp').each(function (i, obj) {
            if (obj.value == '' || obj.value == null || obj.value == '0') {
                var id = obj.attributes.msg.value;
                EmpValidation = false;
                alert('Please Add ' + id);
                return false;

            }
        });
        if (Responsibilities == "") {
            alert('Please Add Responsibilities');
            return false;
        }

        if (EmpValidation) {
            if (!isDateRangeValid(Period)) {
                alert("The new date range overlaps with existing records.");
                return;
            }

            var row = $("#" + Empid);

            row.find('td:eq(0)').text(Period);
            row.find('td:eq(1)').text(EmployerName);
            row.find('td:eq(2)').text(Location);
            row.find('td:eq(3)').text(Designation);
            //row.find('td:eq(4)').text(Responsibilities).html(Responsibilities);
            row.find('td:eq(4)').text(Responsibilities);

            $('.Emp').val('');
            CKEDITOR.instances['txtResponsibilities'].setData('')
            $('#txtPeriodTo').val('');
            $('#txtEmployerName').removeAttr('disabled');
            $('#txtLocation').removeAttr('disabled');
            $('#AddEmployment').css('visibility', 'visible');
            $('#UpdateEmployment').css('visibility', 'hidden');

            rearrangeRows();
        }

    }

    function EditProject(Projid) {
        var row = $("#" + Projid);

        // Find td elements within the selected row
        var tds = row.find('td');

        // Extract values from td elements
        var ActivityInspected = tds.eq(0).text().trim();
        var Codes = tds.eq(1).text().trim();
        var Project = tds.eq(2).text().trim();
        var EndUser = tds.eq(3).text().trim();

        $('#txtProject').val(Project);
        $('#txtActivityInspected').val(ActivityInspected);
        $('#txtCodes').val(Codes);
        $('#txtEndUser').val(EndUser);

        localStorage.setItem('Projid', Projid);
        $('#AddProject').css('visibility', 'hidden');
        $('#UpdateProject').css('visibility', 'visible');
    }

    function UpdateProjectDetails() {
        debugger
        var Projid = localStorage.getItem('Projid');
        var Project = $('#txtProject').val();
        var ActivityInspected = $('#txtActivityInspected').val();
        var Codes = $('#txtCodes').val();
        var EndUser = $('#txtEndUser').val();

        var row = $("#" + Projid);

        row.find('td:eq(0)').text(ActivityInspected);
        row.find('td:eq(1)').text(Codes);
        row.find('td:eq(2)').text(Project);
        row.find('td:eq(3)').text(EndUser);

        $('.Project').val('');
        $('#AddProject').css('visibility', 'visible');
        $('#UpdateProject').css('visibility', 'hidden');
    }

    function EditTraining(Trainid) {
        var row = $("#" + Trainid);

        // Find td elements within the selected row
        var tds = row.find('td');

        // Extract values from td elements
        var Date = tds.eq(0).text().trim();
        var Hours = tds.eq(1).text().trim();
        var Topic = tds.eq(2).text().trim();

        $('#txtTrainingDate').val(Date);
        $('#txtTrainingHours').val(Hours);
        $('#txtTrainingTopic').val(Topic);

        localStorage.setItem('Trainid', Trainid);
        $('#AddTraining').css('visibility', 'hidden');
        $('#UpdateTraining').css('visibility', 'visible');
    }

    function UpdateTrainingDetails() {
        var Trainid = localStorage.getItem('Trainid');
        var Date = $('#txtTrainingDate').val();
        var Hours = $('#txtTrainingHours').val();
        var Topic = $('#txtTrainingTopic').val();

        var row = $("#" + Trainid);

        row.find('td:eq(0)').text(Date);
        row.find('td:eq(1)').text(Hours);
        row.find('td:eq(2)').text(Topic);

        $('.training').val('');
        $('#AddTraining').css('visibility', 'visible');
        $('#UpdateTraining').css('visibility', 'hidden');
    }

    function DeleteEmployment(EmpID) {
        $('#' + EmpID).remove();

        UpdateEmpID();
    }

    function UpdateEmpID() {
        $('#EmpBody').each(function () {
            var trElements = $(this).find('tr');
            trElements.each(function (index) {
                var DeleteTD = $(this).find('td:last');
                var EditTD = $(this).find('td:nth-last-child(2)');
                if (index != 0) {
                    var DeleteBtn = $('<input type="button" class="btn btn-primary" value="Delete" onclick="DeleteEmployment(\'Emp' + (index + 1) + '\')">');
                    DeleteTD.html('');
                    DeleteTD.append(DeleteBtn);
                }
                var EditBtn = $('<input type="button" class="btn btn-primary" value="Edit" onclick="EditEmployment(\'Emp' + (index + 1) + '\')">');

                EditTD.html('');
                EditTD.append(EditBtn);
                $(this).attr('id', 'Emp' + (index + 1));
            });
        });
    }

    function DeleteProject(ProjID) {
        $('#' + ProjID).remove();

        $('#ProjectBody').each(function () {
            var trElements = $(this).find('tr');

            trElements.each(function (index) {
                var DeleteTD = $(this).find('td:last');
                var EditTD = $(this).find('td:nth-last-child(2)');
                var DeleteBtn = $('<input type="button" class="btn btn-primary" value="Delete" onclick="DeleteProject(\'Proj' + (index + 1) + '\')">');
                DeleteTD.html('');
                DeleteTD.append(DeleteBtn);
                var EditBtn = $('<input type="button" class="btn btn-primary" value="Edit" onclick="EditProject(\'Proj' + (index + 1) + '\')">');

                EditTD.html('');
                EditTD.append(EditBtn);
                $(this).attr('id', 'Proj' + (index + 1));
            });
        });
    }

    function DeleteTraining(TrainID) {
        $('#' + TrainID).remove();

        $('#TrainingBody').each(function () {

            var trElements = $(this).find('tr');

            trElements.each(function (index) {
                var DeleteTD = $(this).find('td:last');
                var EditTD = $(this).find('td:nth-last-child(2)');
                var DeleteBtn = $('<input type="button" class="btn btn-primary" value="Delete" onclick="DeleteTraining(\'Train' + (index + 1) + '\')">');
                DeleteTD.html('');
                DeleteTD.append(DeleteBtn);
                var EditBtn = $('<input type="button" class="btn btn-primary" value="Edit" onclick="EditTraining(\'Train' + (index + 1) + '\')">');

                EditTD.html('');
                EditTD.append(EditBtn);
                $(this).attr('id', 'Train' + (index + 1));
            });
        });
    }

    function AddAchievementDetails() {
        debugger
        var AchievementDate = $('#txtAchievementDate').val();
        var Description = $('#txtDescription').val();

        var AchieveValidation = true;

        $('.Achievement').each(function (i, obj) {
            if (obj.value == '' || obj.value == null || obj.value == '0') {
                var id = obj.attributes.msg.value;
                AchieveValidation = false;
                alert('Please Add ' + id);
                return false;

            }
        });

        if (AchieveValidation) {

            count = $('#AchievementBody tr').length + 1;
            $('#AchievementBody').append('<tr id="Achieve' + count + '"><td>' + AchievementDate + '</td><td>' + Description + '</td><td><input type="button" class="btn btn-primary" value="Edit" onclick="EditAchievement(\'Achieve' + count
                + '\')" /></td><td><input type="button" class="btn btn-primary" value="Delete" onclick="DeleteAchievement(\'Achieve' + count + '\')" /></td></tr>')
            $('#AchievementTable').removeAttr('hidden');
            $('#AchieveHR').css('margin-top', '15px');
            $('.Achievement').val('');

        }
    }

    function EditAchievement(Achieveid) {
        var row = $("#" + Achieveid);

        // Find td elements within the selected row
        var tds = row.find('td');

        // Extract values from td elements
        var AchievementDate = tds.eq(0).text().trim();
        var Description = tds.eq(1).text().trim();

        $('#txtAchievementDate').val(AchievementDate);
        $('#txtDescription').val(Description);

        localStorage.setItem('Achieveid', Achieveid);
        $('#AddAchievement').css('visibility', 'hidden');
        $('#UpdateAchievement').css('visibility', 'visible');
    }

    function UpdateAchievementDetails() {
        var Achieveid = localStorage.getItem('Achieveid');
        var AchievementDate = $('#txtAchievementDate').val();
        var Description = $('#txtDescription').val();

        var AchieveValidation = true;

        $('.Achievement').each(function (i, obj) {
            if (obj.value == '' || obj.value == null || obj.value == '0') {
                var id = obj.attributes.msg.value;
                AchieveValidation = false;
                alert('Please Add ' + id);
                return false;

            }
        });

        if (AchieveValidation) {

            var row = $("#" + Achieveid);

            row.find('td:eq(0)').text(AchievementDate);
            row.find('td:eq(1)').text(Description);


            $('.Achievement').val('');
            $('#AddAchievement').css('visibility', 'visible');
            $('#UpdateAchievement').css('visibility', 'hidden');

            rearrangeRows();
        }

    }

    function DeleteAchievement(Achieveid) {

        $('#' + Achieveid).remove();

        $('#AchievementBody').each(function () {

            var trElements = $(this).find('tr');

            trElements.each(function (index) {
                var DeleteTD = $(this).find('td:last');
                var EditTD = $(this).find('td:nth-last-child(2)');
                var DeleteBtn = $('<input type="button" class="btn btn-primary" value="Delete" onclick="DeleteAchievement(\'Achieve' + (index + 1) + '\')">');
                DeleteTD.html('');
                DeleteTD.append(DeleteBtn);
                var EditBtn = $('<input type="button" class="btn btn-primary" value="Edit" onclick="EditAchievement(\'Achieve' + (index + 1) + '\')">');

                EditTD.html('');
                EditTD.append(EditBtn);
                $(this).attr('id', 'Achieve' + (index + 1));
            });
        });
    }

     function UpdateCV() {
        debugger;
        var IsDeclarationCheck = $('#ChkDeclaration').is(':checked');
        if (IsDeclarationCheck == true) {
            var Inspection = $('#Inspection').val();
            var ExpertiseSummary = CKEDITOR.instances['ExpertiseSummary'].getData();
            var IsInspectionCheck = $("#ChkInspection").is(':checked');

            if (Inspection == '') {
                //alert('Please Add Core Competency in Inspection/Assessment of');
                //return false;
                $('#ChkInspection').prop('checked', false);
            }

            if (ExpertiseSummary == '') {
                alert('Please Add Summary of Expertise');
                return false;
            }

            var EmploymentDetails = [];
            $('#EmpHead tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('th').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                EmploymentDetails.push(rowData);
            });

            $('#EmpBody tr').each(function (rowIndex, row) {
                debugger
                var rowData = [];
                $(row).find('td').each(function (cellIndex, cell) {
                    rowData.push($(cell).html().replaceAll(/&lt;/g, '<').replaceAll(/&gt;/g, '>').replaceAll(/&amp;/g, '&').replaceAll(/&nbsp;/g, '\n').trim());
                });
                EmploymentDetails.push(rowData);
            });

            var ProjectDetails = [];
            $('#ProjectHead tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('th').each(function (cellIndex, cell) {
                    rowData.push($(cell).attr('name').trim());
                });
                ProjectDetails.push(rowData);
            });

            $('#ProjectBody tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('td').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                ProjectDetails.push(rowData);
            });

            var TrainingDetails = [];
            $('#TrainingHead tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('th').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                TrainingDetails.push(rowData);
            });
            $('#TrainingBody tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('td').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                TrainingDetails.push(rowData);
            });

            var AchievementDetails = [];
            $('#AchievementHead tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('th').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                AchievementDetails.push(rowData);
            });
            $('#AchievementBody tr').each(function (rowIndex, row) {
                var rowData = [];
                $(row).find('td').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                AchievementDetails.push(rowData);
            });
            var NdtDetails = [];
            $('#NdtHead tr').each(function (rowIndex, row) {
                debugger;
                var rowData = [];
                $(row).find('th').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                NdtDetails.push(rowData);
            });
            $('#ndtData tr').each(function (rowIndex, row) {
                debugger;
                var rowData = [];
                $(row).find('td').each(function (cellIndex, cell) {
                    rowData.push($(cell).text().trim());
                });
                NdtDetails.push(rowData);
            });
            $.ajax({
                url: '@Url.Action("InsertCV", "Users")',
                method: 'POST',
                contentType: 'application/json',
                async: false,
                data: JSON.stringify({
                    Inspection: Inspection,
                    ExpertiseSummary: ExpertiseSummary,
                    IsInspectionCheck: IsInspectionCheck,
                    EmploymentDetails: EmploymentDetails,
                    ProjectDetails: ProjectDetails,
                    TrainingDetails: TrainingDetails,
                    AchievementDetails: AchievementDetails,
                    NdtDetails: NdtDetails
                }),
                success: function (response) {
                    debugger;
                    if (response == true) {
                        alert('Data Saved Successfully');
                        //location.reload();
                        $('#btnDownloadCV').show();
                    }
                },
                error: function (xhr, status, error) {
                    // Handle error response
                    alert('Something went wrong');
                }
            });
        }
        else {
            alert('Please tick the Declaration to Proceed');
            return false;
            
            
        }
    }

    function RefetchInspectionData() {
        $.ajax({
            url: '@Url.Action("RefetchInspectionData", "Users")',
            method: 'GET',

            success: function (response) {
                debugger
                if (response != '') {
                    $('#Inspection').val(response);
                }
            },
            error: function (xhr, status, error) {
                // Handle error response
                alert('Something went wrong');
            }
        });
    }

    function rearrangeRows() {
        var table = document.getElementById("EmpTable").getElementsByTagName('tbody')[0];
        var rows = table.rows;
        var switching = true;
        while (switching) {
            switching = false;
            for (var i = 1; i < rows.length - 1; i++) {
                var shouldSwitch = false;
                var date1 = getDateFromString(rows[i].cells[0].innerText).getTime();
                var date2 = getDateFromString(rows[i + 1].cells[0].innerText).getTime();
                if (date1 < date2) {
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
        UpdateEmpID();
    }

    function isDateRangeValid(newDateRange) {
        debugger;
        var EditedRow = localStorage.getItem('Empid');
        var table = document.getElementById("EmpTable").getElementsByTagName('tbody')[0];
        for (var i = 0; i < table.rows.length; i++) {
            if (table.rows[i].id != EditedRow) {
                var existingDateRange = table.rows[i].cells[0].innerText;
                var startDateExisting = getDateFromString(existingDateRange.split(' to ')[0]);
                var endDateExisting;
                if (existingDateRange.split(' to ')[1] == 'Till Date') {
                    var d = new Date();

                    //var month = d.getMonth() + 1;
                    //var day = d.getDate();

                    //endDateExisting = d.getFullYear() + '/' + (month < 10 ? '0' : '') + month + '/' + (day < 10 ? '0' : '') + day;
                    endDateExisting = d;
                }
                else {
                    endDateExisting = getDateFromString(existingDateRange.split(' to ')[1]);
                }

                var startDateNew = getDateFromString(newDateRange.split(' to ')[0]);
                var endDateNew = getDateFromString(newDateRange.split(' to ')[1]);

                if (startDateNew >= startDateExisting && startDateNew <= endDateExisting) {
                    return false;
                }
            }
        }
        return true;
    }

    function getDateFromString(dateString) {
        var dateParts = dateString.split('/');
        return new Date(dateParts[2], dateParts[1] - 1, dateParts[0]);
    }

</script>
@*<script>
    $(document).ready(function () {
        // Get the values from localStorage and CKEditor
        var TotalEXP = localStorage.getItem('TotalEXP');
        //var ExpertiseSummary = CKEDITOR.instances['ExpertiseSummary'].getData();

        // Check if both values have data (non-empty and valid)
        //if (TotalEXP && ExpertiseSummary) {
        if (TotalEXP) {
            // If both values are present, show the button
            $('#btnDownloadCV').show();
        } else {
            // Otherwise, hide the button
            $('#btnDownloadCV').hide();
        }
    });
</script>*@
<script>
    $(document).ready(function () {
       
        var TotalEXP = localStorage.getItem('TotalEXP');
        $('#EmpBody tr').each(function () {
            var responsibilities = $(this).find('td:nth-child(5)').text().trim(); 
            if (responsibilities !== "" && TotalEXP) {
                console.log('Responsibilities and TotalEXP are present for row: ' + $(this).attr('id'));
                $('#btnDownloadCV').show();  
            } else {
                console.log('Either no responsibilities or TotalEXP is missing for row: ' + $(this).attr('id'));
                $('#btnDownloadCV').hide();  
            }
        });
    });

</script>
