@model TuvVision.Models.LibraryDocumentModel

@{
    ViewBag.Title = "LibraryDocuments";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
}

@*Ashwini Scripts here for datatable starts here*@
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/datatable/js/jquery.dataTables.js"></script>


<!--filepond-->
<script src="~/AllJsAndCss/js/datatable-custom.js"></script>







<style>
    a.menu_links { cursor: pointer; }
     #myInput {
  background-image: url('/css/searchicon.png'); /* Add a search icon to input */
  background-position: 10px 12px; /* Position the search icon */
  background-repeat: no-repeat; /* Do not repeat the icon image */
  width: 100%; /* Full-width */
  font-size: 14px; /* Increase font-size */
  /*padding: 12px 20px 12px 40px;*/ /* Add some padding */
  padding: 6px 19px 5px 16px;
  border: 1px solid #ddd; /* Add a grey border */
  margin-bottom: 12px; /* Add some space below the input */
}
     
    table {
        /*font-family: arial, sans-serif;*/
        font-family:'TNG Pro';
        border-collapse: collapse;
        width: 100%;
    }

    /*td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }*/
     td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }
       th {
       padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            /*background-color: #04AA6D;*/
            background-color: #001ED2;
            color: white;
            font-size:14px;
    }


    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
   
</style>




<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://cdn.ckeditor.com/4.6.0/full/ckeditor.js"></script>

<!--multiselect-->
<link href="~/AllJsAndCss/css/bootstrap-multiselect.css" rel="stylesheet" />

<!--filepond-->
<link href="~/AllJsAndCss/css/filepond.css" rel="stylesheet" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script src="https://cdn.ckeditor.com/4.6.0/full/ckeditor.js"></script>



<!--Start of main content 3-->
<div class="main-content2 xs-max-height">
    <!--Start of header-->
    <div class="container-fluid">
        <div class="row assignfixedwidth rp-15">
            <div class="col-xs-12 col-md-6">

                @if (Session["Doc"].ToString() != null || Session["Doc"].ToString() == "")
                {
                    <h5 class="dynamic-page-title dynamic-page-title-2 text-left" style="margin-bottom:10px;white-space: nowrap;width: 100%;overflow: hidden;text-overflow: ellipsis;"><i class="fa fa-folder-open"></i><span style="font-size:19px;"> @Session["Doc"] / @Model.FolderName </span></h5>
                }
                else
                {
                    <h5 class="dynamic-page-title dynamic-page-title-2 text-left" style="margin-bottom:10px;white-space: nowrap;width: 25%;overflow: hidden;text-overflow: ellipsis;"><i class="fa fa-folder-open"></i> Files </h5>
                }
               
              
            </div><!-- /.col -->
        
        @if (Model.Rollid == 36 || Model.Rollid == 1 || Convert.ToString(System.Web.HttpContext.Current.Session["UserIDs"]) == "TUV0001742" || Convert.ToString(System.Web.HttpContext.Current.Session["UserIDs"]) == "TUV0002556" || Convert.ToString(System.Web.HttpContext.Current.Session["UserIDs"]) == "TUV00280")
        {
            <div class="col-xs-12 col-md-6">
                <form class="form-inline" method="post" enctype="multipart/form-data" id="lform">
                    <div class="form-group">
                        @Html.HiddenFor(model => model.LP_Id)
                        @Html.HiddenFor(model => model.Lib_Id)
                      
                        
                        
                        <input type="file" class="filepond" name="FileUpload" id="FileUpload">
                        <input hidden="hidden" id="hdfFileUpload" name="FileUpload" class="hidden" />
                        
                        <br />
                        @Html.HiddenFor(m => m.PDF)

                        <div class="form-group">
                            <label>Employment category :</label><span style="color:#FA3746;">*</span>
                            <select id="ProductLists" class="form-control form-multiselect-city" multiple="multiple" name="ProductList" placeholder="Select Option" required="required">
                                @{
                                    foreach (var item in @ViewBag.lstEmpCategory)
                                    {
                                        <option value="@item.Value">@item.Text&nbsp; &nbsp;</option>
                                    }
                                }
                            </select>
                            <input type="text" class="hidden" id="ProductLists" />
                            @Html.ValidationMessageFor(model => model.EmployementCategory, "", new { @class = "text-danger" })
                        </div>


                        <div class="form-group">
                            <label>Region of inspection :</label><span style="color:#FA3746;">*</span>
                            <select id="ProductLists1" class="form-control form-multiselect-city" multiple="multiple" name="ProductList1" placeholder="Select Option" required="required">
                                @{
                                    foreach (var item in @ViewBag.InspectionLocation)
                                    {
                                        <option value="@item.Value">@item.Text&nbsp; &nbsp;</option>
                                    }
                                }
                            </select>
                            <input type="text" class="hidden" id="ProductLists1" />
                            @Html.ValidationMessageFor(model => model.Location, "", new { @class = "text-danger" })

                        </div>



                        <div class="form-group">
                            <label>User Role :</label><span style="color:#FA3746;">*</span>

                            <select id="ProductLists2" class="form-control form-multiselect-city" multiple="multiple" name="ProductList2" placeholder="Select Option" required="required">
                                @{
                                    foreach (var item in @ViewBag.lstUserRole)
                                    {
                                        <option value="@item.Value">@item.Text&nbsp; &nbsp;</option>
                                    }
                                }
                            </select>
                            <input type="text" class="hidden" id="ProductLists2" />

                            @Html.ValidationMessageFor(model => model.UserRole, "", new { @class = "text-danger" })

                        </div>

                        @if (Model != null)
                        {
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                        }
                        <br />
                        <br />

                        @Html.DisplayFor(m => m.PDF)

                    </div>
                    <button type="button" class="btn btn-default insert-form-btn" id="btnSave" title="Submit"><i class="fa fa-plus-circle"></i>Save</button>
                </form>
            </div>
        }
          
            <div class="col-xs-12">
                <hr class="custom-hr1">
            </div>
            <div class="col-xs-12">
                <input type="text" id="myInput"  placeholder="Search by Name.">

                <table id="myTable" class="display" cellspacing="0" width="60%"> @*library-dt*@
                    <thead>
                        <tr class="header">
                            @if (Model.Rollid == 1 || Model.Rollid == 36)
                            {
                                <th width="5%" class="remove-search" style="padding: 10px 10px !important;">Action</th>
                            }
                            <th class="remove-search" style="padding: 10px 10px !important;" >Name</th>
                         
                            <th class="remove-search" style="padding: 10px 10px !important;" width="5%">View</th>
                       
                        </tr>
                    </thead>

                    @*<tbody>*@
                        @foreach (var item in ViewData["LibraryList"] as IEnumerable<TuvVision.Models.LibraryDocumentModel>)
                        {
                            <tr>
                                @if (Model.Rollid == 1 || Model.Rollid == 36)
                                {
                                    <td>                                        
                                        <a href="@Url.Action("DeleteLibraryDocuments", "Library", new {@LP_Id = item.LP_Id , @Lib_Id = item.Lib_Id })" onclick="return confirm('Are you sure you want to Delete this Record?')"><i class="fa fa-trash-o" style="color:red;"></i>&nbsp;</a>
                                    </td>
                                }
                                <td>


                                    @if (item.PDF.ToString().ToUpper().EndsWith(".TXT") || item.PDF.ToString().ToUpper().EndsWith(".DOC") || item.PDF.ToString().ToUpper().EndsWith(".DOCX") || item.PDF.ToString().ToUpper().EndsWith(".RAR"))
                                    {
                                        
                                        <img src="~/library-types/pdf.png" download width="15" />
                                        @item.PDF

                                    }

                                    @if (item.PDF.ToString().ToUpper().EndsWith(".XLSX") || item.PDF.ToString().ToUpper().EndsWith(".XLS") || item.PDF.ToString().ToUpper().EndsWith(".XLS"))
                                    {
                                        <img src="~/library-types/excel.png" download width="15" />
                                        @item.PDF

                                    }

                                    @if (item.PDF.ToString().ToUpper().EndsWith(".PDF") || item.PDF.ToString().ToUpper().EndsWith(".JPEG") || item.PDF.EndsWith(".JPG") || item.PDF.ToString().ToUpper().EndsWith(".GIF") || item.PDF.ToString().ToUpper().EndsWith(".PNG"))
                                    {
                                        <img src="~/library-types/pdf.png" download width="15" />
                                        @item.PDF

                                    }
                                    @if (item.PDF.ToString().ToUpper().EndsWith(".MP4") || item.PDF.ToString().ToUpper().EndsWith(".WMV"))
                                    {
                                        <img src="~/library-types/MP.png" download width="15" />
                                        @item.PDF

                                    }
                                </td>



                                
                                
                                <td align="center">
                                    <a onclick="javascript:GetClientReport('@item.PDF','@item.LP_Id');"  id="btnView1" class="menu_links" align="center">
                                        &nbsp;&nbsp;&nbsp;<img src="@Url.Content("~/View1.png")" />
                                    </a>
                                </td>
</tr>
                        }

                    @*</tbody>*@

                </table>
            </div><!-- /.data table col -->

        </div><!-- /.row -->



    </div><!-- /.container-fluid -->
    <!--End of header-->

</div>
<!--End of main content 3-->

<script>
    $("#btnSave").click(function myfunction() {
            
    });

    function validateform() 
    {
        return true;
    }
</script>





  


<script>
    document.addEventListener("keyup", function(event)
    {
       // alert("keyup " + event.keyCode);

        if ((event.ctrlKey && event.keyCode == 80))
        {
            return false;
        }
    });


    document.addEventListener("keydown", function (event)
    {
     //   alert("keydown  " + event.keyCode);

        if ((event.ctrlKey && event.keyCode == 80))
        {
            return false;
        }


    });

    document.addEventListener("keypress", function (event) {
       // alert("keypress  " + event.keyCode);

        if ((event.ctrlKey && event.keyCode == 80)) {
            return false;
        }
    });


</script>

<script>
    function GetClientReport(File,id)
    {

        if(File.substring(File.length - 3).toUpperCase()=="PDF")
        {
            window.open('GetPDF?FileName=' + File + "&#toolbar=0", "_blank",'noopener,noreferrer,resizable');
        }
        else if(File.substring(File.length - 3).toUpperCase()=="MP4")
        {
            window.open("../MisReport/PlayLibVideo/" + id + "?VideoFile=" + File);            
            return false;
        }
        else
        {
            window.location.href = "../LibraryFiles/" + File;
            return false;
        }
    }

</script>



<script src="~/AllJsAndCss/js/bootstrap-multiselect.js"></script>
<link href="~/AllJsAndCss/css/bootstrap-multiselect.css" rel="stylesheet" />

<script>
     $(function () {
         $('#ProductLists').multiselect({
             includeSelectAllOption: true
         });

     });

     $(function () {
         $('#ProductLists1').multiselect({
             includeSelectAllOption: true
         });

     });

     $(function () {
         $('#ProductLists2').multiselect({
             includeSelectAllOption: true
         });

     });
</script>

<script>
    $('.form-multiselect-city').multiselect({
        enableFiltering: true,
        includeSelectAllOption: true,
        enableCaseInsensitiveFiltering: true
    });
</script>

<script>
    $("#btnSave").on('click', function (event)
    {

        if (validateform() == false) {
            return false;
        }
        else 
        {
            debugger;


            alert(1234);

            var selected = $("#ProductLists option:selected");
            var ddlCategory = "";
            selected.each(function () {
                ddlCategory += $(this).val() + ",";
            });
            ddlCategory = ddlCategory.replace(/,\s*$/, "");



            var Locationselected = $("#ProductLists1 option:selected");
            var ddlLocationselected = "";
            Locationselected.each(function () {
                ddlLocationselected += $(this).val() + ",";
            });
            ddlLocationselected = ddlLocationselected.replace(/,\s*$/, "");



            var Roleselected = $("#ProductLists2 option:selected");
            var ddlRoleselected = "";
            Roleselected.each(function () {
                ddlRoleselected += $(this).val() + ",";
            });
            ddlRoleselected = ddlRoleselected.replace(/,\s*$/, "");


            var LibraryDetails =
            {
                EmployementCategory: ddlCategory,
                Location: ddlLocationselected,
                UserRole: ddlRoleselected,
               //// multiImage: $("#FileUpload").val(),
                PK_SubSubID: $("#Lib_Id").val(),

            }

            $.ajax({
                type: 'POST',
                url: '@Url.Action("TDocuments", "Library")',
                dataType: 'json',
                Async: false,
                data: JSON.stringify({ LB: LibraryDetails }),
                enctype: "multipart/form-data",
                contentType: "application/json; charset=utf-8",
                success: function (response) {

                    if (response.result == 'Redirect')
                    {
                        alert("User Details has been Save successfully!!!")
                        window.location = response.url;
                    }

                    if (response.result == 'Update')
                    {
                        alert("User Details has been updated successfully!!!")
                        window.location = response.url;
                    }
                    else if (response.success == 2)
                    {
                        alert("please select auto suggestions certificate Name !")
                    }
                }
            })
        }

    });


</script>
<!--filepond-->
<!-- Load FilePond library -->
<script src="~/AllJsAndCss/js/filepond.js"></script>

<!-- Turn all file input elements into ponds -->
<script>
    FilePond.parse(document.body);
</script>

<script>
    FilePond.registerPlugin(
    // encodes the file as base64 data
    FilePondPluginFileEncode,
    // validates the size of the file
    FilePondPluginFileValidateSize,
    // corrects mobile image orientation
    FilePondPluginImageExifOrientation,
    // previews dropped images
    FilePondPluginImagePreview
    );
    // Select the file input and use create() to turn it into a pond
    FilePond.create(document.querySelector('.filepond'));
</script>
<script>
        FilePond.setOptions({
            server: '@Url.Action("TemporaryFilePathQuotationAttachment", "Library")'
        });
</script>

