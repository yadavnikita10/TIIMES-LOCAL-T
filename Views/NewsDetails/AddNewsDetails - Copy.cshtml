@model TuvVision.BusinessEntities.News_VM

@{
    ViewBag.Title = "AddNewsDetails";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
}

<link href="~/Scripts/Js/jquery-ui.css" rel="stylesheet" />

<style>
    .field-validation-valid{
        color:red;
    }
</style>

<style>
    /*-- Delete color-profile --*/
    ul.Attachment {
        padding-left: 0px;
        list-style: none;
        margin-bottom: 0px;
    }

        ul.Attachment > li {
            border: 1px solid #999;
            margin: 7px 5px 0 0;
            display: inline-block;
            padding: 0px 10px;
            background-color: #dfdfdf;
            color: #000;
        }

            ul.Attachment > li a.title {
                color: #000;
                vertical-align: text-bottom;
                text-transform: capitalize;
            }

            ul.Attachment > li a.deleteItem {
                color: white;
                font-size: 10px;
                background: #e91e1e;
                padding: 2px 4px;
                border-radius: 50%;
                vertical-align: text-top;
            }
</style>

<div class="main-content2 grey-bg-f3">

    <!--Start of header-->
    <div class="container-fluid">
        <div class="row assignfixedwidth rp-5">

            <div class="col-xs-12 form-col">
                <div class="row">

                    @*<div class="col-xs-12 text-right">
                            <a href="@Url.Action("Details", "Question",new { id = Model.FD_FK_Checklist_Log_Id })" clas class="btn btn-info dynamic-function-btn"><i class="fa fa-long-arrow-left"></i> Go Back</a>
                        </div>*@
                    <div class="col-xs-12 text-right">
                        <a href="@Url.Action("GetListOfNews", "NewsDetails")" class="btn btn-info dynamic-function-btn"><i class="fa fa-long-arrow-left"></i> Go Back</a>
                    </div>

                    <div class="col-xs-12">
                        <div class="white-bg section-box-shadow">
                            <h3 class="form-page-title">Add News</h3>
                            <div class="row">
                                <div class="col-xs-12 col-sm-offset-1 col-sm-10">
                                    <div class="form-box">
                                        @using (Html.BeginForm("AddNewsDetails", "NewsDetails", FormMethod.Post, new { @class = "form-horizontal form-label-left", @enctype = "multipart/form-data", @id = "formaddnews" }))
                                        {
                                            @Html.HiddenFor(m => m.PK_NewsId)
                                            @Html.HiddenFor(m => m.CreatedDate)

                                            <div class="row">


                                                <div class="col-xs-12 col-sm-12">
                                                    <div class="form-group">
                                                        <label>News Header: <span class="required">*</span></label>
                                                        @Html.TextBoxFor(model => model.Title, new { @type = "text", @class = "form-control", @placeholder = "Enter News Title", @required = "required" })
                                                    </div>
                                                </div>

                                                <div class="col-xs-12 col-sm-12">
                                                    <div class="form-group">
                                                        <label>Short Description: <span class="required">*</span></label>
                                                        @Html.TextAreaFor(model => model.StortDescription, new { @type = "text", @class = "form-control", @placeholder = "Enter Short Description", @rows = "2", @required = "required", @minlength = "3", @maxlength = "150" })
                                                    </div>
                                                </div>

                                                <div class="col-xs-12 col-sm-6">
                                                    <div class="form-group">
                                                        <label>Cover Image (if Any):</label>
                                                        @Html.TextBoxFor(model => model.NewsImage, new { @type = "file", @id= "file", @class = "form-control" })
                                                        @Html.HiddenFor(m => m.NewsImage)
                                                    </div>
                                                </div>


                                               

                                                <div class="col-xs-12 col-sm-12">
                                                    <div class="form-group">
                                                        <label>News Details:</label>
                                                        @Html.TextAreaFor(model => model.HtmlContent, new { @class = "form-control tinymces", @rows = "4", @placeholder = "Enter News Description" })
                                                    </div>
                                                </div>

                                                <div class="col-xs-12 col-sm-4">
                                                    <div class="form-group">
                                                        <label>Event Images (if Any):</label>
                                                        @Html.TextBoxFor(model => model.NewsEvent, new { @type = "file", @multiple = "multiple", @id = "NewsEvent", @class = "form-control" })
                                                    </div>
                                                </div>

                                              
                                                <div class="col-xs-12 col-sm-4">
                                                    <div class="form-group text-center">
                                                        <label>Status: <span class="required">*</span> @Html.ValidationMessageFor(a => a.Status)</label>
                                                        <br>
                                                        Active: @Html.RadioButtonFor(m => m.Status, 1, new { @required = "required" })
                                                        InActive: @Html.RadioButtonFor(m => m.Status, 2)
                                                    </div>
                                                </div>

                                                <div class="col-xs-12 col-sm-12">
                                                    @if (Model != null)
                                                    {
                                                        if (Model.FileDetails != null && Model.FileDetails.Count > 0)
                                                        {
                                                            <div class="row">
                                                                <div class="col-xs-12">
                                                                    <div class="form-group">
                                                                        <ul class="Attachment">
                                                                            @foreach (var item in Model.FileDetails)
                                                                            {
                                                                                <li>
                                                                                    <a class="title" href="/Complaint/Download/?p=@(item.IDS + item.Extension)&d=@item.FileName">@item.FileName</a>
                                                                                    <a href="javascript:void(0);" data-id="@item.IDS" class="deleteItem">X</a>
                                                                                </li>
                                                                            }
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <p style="color:red;text-align:center;font-weight:bold;">No Files Uploaded</p>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <p style="color:red;text-align:center;font-weight:bold;">There are no Attachments !</p>
                                                    }
                                                </div>

                                                <div class="col-xs-12 col-sm-12">
                                                    <div class="form-group text-center">
                                                        <button type="submit" class="btn btn-info dynamic-function-btn" id="btnAddNews">Submit</button>
                                                        <a href="~/NewsDetails/GetListOfNews" class="btn btn-info dynamic-function-btn">Cancel</a>
                                                    </div>
                                                </div>


                                            </div>
                                        }
                                    </div>

                                </div>
                            </div><!-- /.row -->

                        </div><!-- /.box-shadow -->
                    </div><!-- /.col -->

                </div><!-- /.row -->
            </div><!-- /.col -->



        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
    <!--End of header-->

</div>

<script src="~/Scripts/js/tinymce.min.js"></script>
<script src="~/Scripts/js/tinymces.js"></script>
<script src="~/Scripts/js/jquery-ui-1.12.1.js"></script>
<script>

        $(document).ready(function () {
            $('.DatePicker').datepicker({
                dateFormat: "dd MM yy",
                changeYear: true,
                changeMonth: true
            });
        })

        $("#NewsImage").change(function () {
            var fileExtension = ["png", "PNG", "jpg", "JPG", "JPEG", "gif"];
            var files = $("#NewsImage input[type='file']").get().files;
            var singleExtension = e.target.files[index].name.split('.').pop();
            var Condition = fileExtension.includes(singleExtension);
            if (Condition == false)
            {
                alert("please select Images only !");
                return false;
            }

        });

        $("#btnAddNews").click(function myfunction()
        {
            if(validateform()==false)
            {
                return false;
            }
            else
            {
                $("#formaddnews").submit();
            }

        });

        function validateform() {
            debugger;
            

            var fileInput = document.getElementById("file");
            var filepath = fileInput.value;

            

            var fileInput1 = document.getElementById("NewsEvent");
            var filepath1 = fileInput1.value;

            var allowedExtension = /(\.jpg|\.jpeg|\.png|\.gif)$/i;

            
            
            if ($("#NewsImage").val() == "" || $("#NewsImage").val() == null) {
                alert("Please Select Cover Image for News!");
                $("#file").focus()
                return false;
            }

            if ($("#Title").val() == "" || $("#Title").val() == null)
            {
                alert("Please enter News Title !");
                $("#Title").focus()
                return false;
            }


            if ($("#StortDescription").val() == "" || $("#StortDescription").val() == null) {
                alert("Please enter Short Description !");
                $("#StortDescription").focus()
                return false;
            }


            //if ($("#HtmlContent").val() == "" || $("#HtmlContent").val() == null) {
            //    alert("Please enter News Description !");
            //    $("#HtmlContent").focus()
            //    return false;
            //}
            //if ($("#NewsFrom").val() == "" || $("#NewsFrom").val() == null) {
            //    alert("Please select News From Date !");
            //    $("#NewsFrom").focus()
            //    return false;
            //}
            //if ($("#NewsTo").val() == "" || $("#NewsTo").val() == null) {
            //    alert("Please select News To Date !");
            //    $("#NewsTo").focus()
            //    return false;
            //}
            //if ($("#NewsFrom").val() > $("#NewsTo").val()){
            //    alert("Please select From Date prior to Upto Date..!");
            //    $("#NewsTo").focus()
            //    return false;
            //}
            //if (!allowedExtension.exec(filepath)) {
            //    alert("Please select Image file only !");
            //    fileInput.value = '';
            //    return false;
            //}
            //if (!allowedExtension.exec(filepath1)) {
            //    alert("Please select Image file only !");
            //    fileInput1.value = '';
            //    return false;
            //}
        }

</script>

<script>
    $(document).ready(function () {
        $('.deleteItem').click(function (e) {
            debugger;
            e.preventDefault();
            var $ctrl = $(this);
            var EnquiryID = $("#EQ_ID").val();
            if (confirm('Do you really want to delete this file?')) {
                $.ajax({
                    url: '@Url.Action("DeleteFile")',
                    type: 'POST',
                    data: { id: $(this).data('id'), EnquiryID: $("#EQ_ID").val() }
                }).done(function (data) {
                    if (data.Result == "OK") {
                        $ctrl.closest('li').remove();
                    }
                    else if (data.Result.Message) {
                        alert(data.Result.Message);
                    }
                }).fail(function () {
                    alert("There is something wrong. Please try again.");
                })

            }
        });
    });

</script>


