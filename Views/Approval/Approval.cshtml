@model TuvVision.Models.Approval

@{
    ViewBag.Title = "Approval";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
    int k = 0;
    double sum = 0;
    double appamount = 0;
}


@*calender control*@

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>


@using (Html.BeginForm("Approval", "Approval", FormMethod.Post, new { enctype = "multipart/form-data", @id = "form1" }))
{
    <div class="main-content3 xs-max-height">

        <!--Start of header-->
        <div class="container-fluid">
            <div class="row assignfixedwidth rp-15">



                <div class="col-xs-12">
                    <hr class="custom-hr">
                </div><!-- /.col -->
                <!--Table was here-->

            </div>


            
            <div class="col-xs-12">
                <h3 class="dynamic-page-title dynamic-page-title-2  text-left">Approval</h3>
            </div><!-- /.col -->

            <div class="col-xs-12 text-right">
                <a href="@Url.Action("VoucherForApproval", "Approval")" class="btn btn-info dynamic-function-btn"><i class="fa fa-long-arrow-left"></i> Go Back</a>

            </div>

            @Html.HiddenFor(m=>m.Inspector)
            <div class="col-xs-12">
                <table id="example" class="display" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                           
                               
                            <th class="hidden">PKExpenseId</th>
                            <th>Date</th>
                            <th>Expense Name</th>
                            <th>Country</th>
                            <th>Currency</th>
                            <th>Amount</th>
                            <th>Ex. Rate</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Approval Amount </th>
                        </tr>
                    </thead>

                   

                    @if (ViewData["InspectorVoucherDetail"] != null)
                    {
                        <tbody>

                            @foreach (var b in ViewData["InspectorVoucherDetail"] as IEnumerable<TuvVision.Models.ApprovalList>)
                            {



                                <tr>
                                    <td class="hidden">@Html.HiddenFor(m => m.ApprovalList[k].LPKExpenseId, new { Value = @b.LPKExpenseId })</td>
                                    
                                    <td>@b.LDate.ToString("dd/MM/yyyy")</td>
                                    <td>@b.LExpenseType</td>
                                    <td>@b.LCountry</td>
                                    <td>@b.LCurrency</td>
                                    <td>@b.LTotalAmount</td>
                                    <td>@b.LExchRate</td>
                                    <td>@b.LDescription</td>
                                    <td>@b.LTotalAmount</td>
                                    <td>                                        
                                        @Html.TextBoxFor(m => m.TotalAmount, htmlAttributes: new { placeholder = "Approved Amount", @class = "form-control", autocomplete = "off", Value = @b.LTotalAmount,@readonly="readonly" })
                                    </td>
                                </tr>
                                k++;
                                sum = sum + b.LTotalAmount;
                                if(b.LAprovelAmount != 0)
                                {
                                    appamount = b.LAprovelAmount;
                                }

                            }
                            <tr>
                                <td class="hidden"></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>Total Amount</td>
                                <td>
                                    <input type="text" value="@sum" id="TotalAmount" name="TotalAmount" />                                    
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="hidden"></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>Approved Amount</td>

                                @if (appamount == 0)
                                {
                                <td>
                                    <input type="text" value="@sum" id="AppAmount" name="AppAmount" />
                                </td>
                                }
                                else
                                {
                                    <td>
                                        <input type="text" value="@appamount" id="AppAmount" name="AppAmount" />
                                    </td>

                                }
                            </tr>
                        </tbody>
                    }
                </table>

            </div>

            <div class="col-xs-4">
                @*<a href="@Url.Action("ProvideApproval", "Approval")" data-form-method="post" class="btn btn-primary form-control" title="Edit">Save</a>*@
                <button type="submit" class="btn btn-default insert-form-btn"> Save </button>

            </div>

        </div>

    </div>
}

<script type="text/javascript" language="javascript" src="~/AllJsAndCss/datatable/js/jquery.dataTables.js"></script>

<!--export to excel-->
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/jszip.min.js"></script>
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/buttons.html5.min.js"></script>
<script src="~/AllJsAndCss/js/datatable-custom2.js"></script>



@*Date Picker for From Date*@

<script>
    $(function () {
        $(".FromD").datepicker({
            dateFormat: 'yy-mm-dd',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"
        });
    });
</script>
<script>
    $(function () {
        $(".ToD").datepicker({
            dateFormat: 'yy-mm-dd',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"
        });
    });
</script>

<script>
$(document).ready(function () {
    $("#ckbCheckAll").click(function () {
        $(".checkBoxClass").prop('checked', $(this).prop('checked'));
    });
});
</script>

<script>
$("a[data-form-method='post']").click(function (event) {
    event.preventDefault();
    var element = $(this);
    var action = element.attr("href");
    element.closest("form").each(function () {
        var form = $(this);
        form.attr("action", action);
        form.submit();
    });
});
</script>
<script>
    $(document).ready(function () {
        $("#example td:nth-child(1)").each(function () {
            var col_val = $(this).find("td:eq(1)").text();
            if (col_val == "Transfer To FI") {
                $(this).parent("tr").css("background-color", "red");
            }
        });
    });
</script>



