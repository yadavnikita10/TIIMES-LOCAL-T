@*@model IEnumerable<TuvVision.Models.QuizModel>*@ 
@model TuvVision.Models.QuizModel 
@{
    ViewBag.Title = "QuestionList";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
    int i = 0;
    int sk = Convert.ToInt32(ViewBag.ID);
}

@*Calender Control*@
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<script>
    $(function () {
        $(".CQuizeEndDate").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"

        });
    });
</script>
<script>
    $(function () {
        $(".CQuizeStartDate").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"

        });
    });
</script>
<script>
    $(function () {
        $(".CReattendQuizStartDate").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"

        });
    });
</script>
<script>
    $(function () {
        $(".CReattendQuizEndDate").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"

        });
    });
</script>



@using (Html.BeginForm())
{
    <div class="main-content3 xs-max-height grey-bg-f3">
        <div class="grey-bg-f3">
            <!--Start of header-->
            <div class="container-fluid">
                <div class="row assignfixedwidth rp-5">

                    <div class="col-xs-12 form-col">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12 text-right">
                                <br />
                                <a href="@Url.Action("AddQuiz", "Quiz", new { @rid = sk })" class="btn btn-default insert-form-btn"><i class="fa fa-plus-circle"></i> Add New Question</a>
                                <a href="@Url.Action("TrainingSchedule", "TrainingSchedule" , new {@UserID = Model.QuizID })" class="btn btn-default insert-form-btn"><i class="fa fa-long-arrow-left"></i> Go Back</a>
                                <a href="@Url.Action("ExportSetQuizeList", "Quiz" , new {@PK_TrainingScheduleId = Model.QuizID })" class="btn btn-info dynamic-function-btn dynamic-function-btn-2" style="margin-top:15px;margin-left:3px;">Export To Excel</a>

                            </div>
                            <br />
                            <br />
                            <div class="col-xs-12">
                                <div class="white-bg section-box-shadow">
                                    <h3 class="form-page-title">Question List</h3>
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-offset-1 col-sm-10">
                                            <div class="form-box">
                                                <form>
                                                    <div class="row">
                                                        <div class="col-xs-12 col-sm-4">
                                                            @*@Html.HiddenFor(model => model.PK_TrainingScheduleId)*@   
                                                            @Html.HiddenFor(m => m.QuizID)                                                         
                                                        </div>
                                                    </div>
                                                    @*@using (Html.BeginForm("SubmitQ", "Quiz", FormMethod.Post, new { enctype = "multipart/form-data", @id = "formqz" }))
                                                    {*@
                                                         <div class="row" id="divQuize">
                                                             <div class="col-xs-12 col-sm-4">
                                                                 <div class="form-group">
                                                                     <label>Quiz Start Date:</label>

                                                                     @Html.TextBoxFor(model => model.QuizStartDate, "{0:dd MMM yyyy}", htmlAttributes: new { placeholder = "Select Start Date", @class = "form-control form-control-custom CQuizeStartDate", autocomplete = "off" })


                                                                     @Html.ValidationMessageFor(model => model.QuizStartDate, "", new { @class = "text-danger validation-msg" })
                                                                 </div>
                                                             </div>
                                                            <div class="col-xs-12 col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Quiz End Date:</label>

                                                                    @Html.TextBoxFor(model => model.QuizeEndDate, "{0:dd MMM yyyy}", htmlAttributes: new { placeholder = "Select Start Date", @class = "form-control form-control-custom CQuizeEndDate", autocomplete = "off" })


                                                                    @Html.ValidationMessageFor(model => model.QuizeEndDate, "", new { @class = "text-danger validation-msg" })
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-12 col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Quiz Total Quetion:</label>
                                                                    @Html.TextBoxFor(model => model.QuizeEndTime1, htmlAttributes: new { placeholder = "Quize Total Quetion", @class = "form-control", autocomplete = "off" })


                                                                    @Html.ValidationMessageFor(model => model.QuizeEndTime1, "", new { @class = "text-danger validation-msg" })
                                                                </div>
                                                            </div>
                                                             <div class="col-xs-12 col-sm-4">
                                                                 <div class="form-group">
                                                                     <label>Reattempt Quiz Start Date:</label>

                                                                     @Html.TextBoxFor(model => model.ReattendQuizStartDate, "{0:dd MMM yyyy}", htmlAttributes: new { placeholder = "Select Start Date", @class = "form-control form-control-custom CReattendQuizStartDate", autocomplete = "off" })


                                                                     @Html.ValidationMessageFor(model => model.ReattendQuizStartDate, "", new { @class = "text-danger validation-msg" })
                                                                 </div>
                                                             </div>
                                                             <div class="col-xs-12 col-sm-4">
                                                                 <div class="form-group">
                                                                     <label>Reattempt Quiz End Date:</label>

                                                                     @Html.TextBoxFor(model => model.ReattendQuizEndDate, "{0:dd MMM yyyy}", htmlAttributes: new { placeholder = "Select End Date", @class = "form-control form-control-custom CReattendQuizEndDate", autocomplete = "off" })


                                                                     @Html.ValidationMessageFor(model => model.ReattendQuizEndDate, "", new { @class = "text-danger validation-msg" })
                                                                 </div>
                                                             </div>

                                                             <div class="col-xs-12 col-sm-4">
                                                                 <div class="form-group">
                                                                     <label>Quiz End Period In Minutes:</label>

                                                                     @Html.TextBoxFor(model => model.QTimeInMinutes, htmlAttributes: new { placeholder = "Q Time In Minutes", @class = "form-control", autocomplete = "off" })

                                                                     @Html.ValidationMessageFor(model => model.QTimeInMinutes, "", new { @class = "text-danger validation-msg" })
                                                                 </div>
                                                             </div>
                                                             @*<div class="col-xs-12 col-sm-4">
                                                                 <div class="form-group">
                                                                     <label>Reattempt Quiz Total Quetion:</label>
                                                                     @Html.TextBoxFor(model => model.ReattendQuizTotalQuestion, htmlAttributes: new { placeholder = "Quize Total Quetion", @class = "form-control", autocomplete = "off" })


                                                                     @Html.ValidationMessageFor(model => model.ReattendQuizTotalQuestion, "", new { @class = "text-danger validation-msg" })
                                                                 </div>
                                                             </div>*@
                                                            <div class="col-xs-12 col-sm-4">
                                                                <div class="form-group">
                                                                    <button type="button" class="btn btn-default insert-form-btn" id="btnUserSave1" style="margin-bottom:45px;"> Update </button>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    @*}*@
                                                    <h3 class="form-page-title">@ViewBag.TP</h3>
                                                    <div>
                                                        @{
                                                            if (Convert.ToString(TempData["Success"]) != null && Convert.ToString(TempData["Success"]) != "")
                                                            {
                                                                <h5 style="color:green;font-weight:bold;">@Convert.ToString(TempData["Success"])</h5>
                                                            }
                                                            if (Convert.ToString(TempData["Deleted"]) != null && Convert.ToString(TempData["Deleted"]) != "")
                                                            {
                                                                <h5 style="color:red;font-weight:bold;">@Convert.ToString(TempData["Deleted"])</h5>
                                                            }
                                                            if (Convert.ToString(TempData["Error"]) != null && Convert.ToString(TempData["Error"]) != "")
                                                            {
                                                                <h5 style="color:red;font-weight:bold;">@Convert.ToString(TempData["Error"])</h5>
                                                            }
                                                        }
                                                    </div>                                                   


                                                 

                                                    <div class="col-xs-12">
                                                        @*<table id="example" class="display" cellspacing="0" width="100%">*@
                                                        <table id="example" class="display" cellspacing="0" width="100%">
                                                            <thead>
                                                                <tr>
                                                                    <th>Sr.No</th>
                                                                    <th>Question</th>
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>

                                                            <tbody>
                                                                @*@Html.HiddenFor(m => m.RTrainingScheduleId, new { Value = ViewBag.Data })*@

                                                                @foreach (var v in ViewBag.QuestionList as IEnumerable<TuvVision.Models.QuizModel>)
                                                                {
                                                                    i = i + 1;
                                                                    <tr>
                                                                        <td scope="row"> @i </td>
                                                                        <td>
                                                                            @v.Question                                                                        
                                                                        </td>
                                                                        <td>
                                                                            <a href="@Url.Action("AddQuiz", "Quiz", new { @qid = v.QuizID, @rid= sk })" title="Edit"><i class="fa fa-pencil"></i></a>
                                                                            <a href="@Url.Action("DeleteQuestion", "Quiz", new { @bid = v.QuizID, @tid=@sk })" onclick="return confirm('Are you sure you want to Delete this Record');" class="delete" title="Delete"><i class="fa fa-trash-o"></i></a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<script>
    $("#btnUserSave1").on('click', function (event)
    {
        debugger;
        var varQuizeEndDate = $("#QuizeEndDate").val();
        var varQuizStartDate = $("#QuizStartDate").val();
        var QuizeEndTime1 = $("#QuizeEndTime1").val();

        var VarReattendQuizStartDate = $("#ReattendQuizStartDate").val();
        var VarReattendQuizEndDate = $("#ReattendQuizEndDate").val();
        var VarQTimeInMinutes = $("#QTimeInMinutes").val();
        


        var varQuizID = $("#QuizID").val();

        if (QuizeEndTime1 == "" || QuizeEndTime1 == null) {
            alert("Please Enter Total Question !!!");
            $("#QuizeEndTime1").focus()
            return false;
        }
        if (varQuizeEndDate == "" || varQuizeEndDate == null) {
            alert("Please Enter Quiz End Date!!!");
            $("#QuizeEndDate").focus()
            return false;
        }
        if (varQuizStartDate == "" || varQuizStartDate == null) {
            alert("Please Enter Quiz Start Date!!!");
            $("#QuizStartDate").focus()
            return false;
        }
        if (VarQTimeInMinutes == "" || VarQTimeInMinutes == null) {
            alert("Please Enter Quiz End Period In Minutes!!!");
            $("#QTimeInMinutes").focus()
            return false;
        }
        
        
        var TrainingDetails =
      {
          QuizeEndDate: varQuizeEndDate,
          QuizeEndTime1: QuizeEndTime1,
          PK_TrainingScheduleId: varQuizID,
          QuizStartDate:varQuizStartDate,
          ReattendQuizStartDate: VarReattendQuizStartDate,
          ReattendQuizEndDate: VarReattendQuizEndDate,
          QTimeInMinutes: VarQTimeInMinutes
      }
        $.ajax({
            type: 'POST',
            url: '@Url.Action("SubmitQ", "Quiz")',
            dataType: 'json',
            Async: false,
            data: JSON.stringify({ TSM: TrainingDetails}),
            enctype: "multipart/form-data",
            contentType: "application/json; charset=utf-8",
            success: function (response) {

                if (response.result == 'Redirect') {
                    alert("Details has been updated successfully!!!")
                    window.location = response.url;
                }

                if (response.result == 'Update') {
                    alert("Training Details has been updated successfully!!!")
                    window.location = response.url;
                }
            }
        })


    })

</script>


