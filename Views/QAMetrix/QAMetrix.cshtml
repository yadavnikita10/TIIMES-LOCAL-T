@model TuvVision.Models.CallsModel
@using NonFactors.Mvc.Grid;
@using System.Web.Mvc;
@using System.Data.SqlClient;
@using System.Data;

@{
    ViewBag.Title = "QAMetrix";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
}


@*DATEPICKER*@
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />

@*<link href="~/AllJsAndCss/css/MVCGridN.css" rel="stylesheet" />*@

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
@*<script src="~/Scripts/MvcGrid/jquery.quicksearch.js"></script>*@
@*<script src="~/Scripts/MvcGrid/dataTables.fixedColumns.min.js"></script>*@
<script>
    $(function () {
        $(".FromD").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"
        });
    });
</script>
<script>
    $(function () {
        $(".ToD").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+50"
        });
    });
</script>

<style>
    /* Set the table layout to fixed */
    table {
        table-layout: fixed;
        width: 100%;
        border-collapse: collapse;
    }

    /* Apply the same width and a border to all table cells */
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: center;
    }

    /* Ensure text wraps within cells */
    th {
        /*white-space: normal;
        word-wrap: break-word;*/
        background-color: #104193;
        color: #ffffff;
        /*writing-mode: vertical-rl;*/
    position: center;
    /*transform: rotate(0);*/
    text-align: start;
    font-weight: normal;
    }
     .slanted-heading_ {
        transform: skewY();
        white-space: nowrap;
        text-wrap: inherit;
        border-bottom: 1px;
        writing-mode: vertical-rl;
    }

    /*.rotate-heading {
        -ms-transform: rotate(-60deg);
        transform: rotate(-60deg);
    }*/
    /* Apply specific styling to the table body */
    tbody td {
        /*white-space: nowrap;*/
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 12px;
        font-family:'TNG Pro';
    }
</style>

@using (Html.BeginForm("QAMetrix", "QAMetrix", FormMethod.Post, new { enctype = "multipart/form-data", @id = "form1" }))
{
    <div class="main-content3 xs-max-height">
        <div class="container-fluid">
            <!--Start of header-->
            <div class="col-xs-12">
                <div class="col-xs-12">
                    <h3 class="dynamic-page-title dynamic-page-title-2  text-left"><b>QA Metrix</b></h3>
                    <br />
                    <br />
                    <div class="row">
                        <div class="col-xs-3">
                            <div class="form-group">
                                <label>From Date:</label>
                                @Html.TextBoxFor(model => model.FromDate, "{0:dd MMM yyyy}", htmlAttributes: new { placeholder = "Select Start Date", @class = "form-control form-control-custom FromD", autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.FromDate, "", new { @class = "text-danger validation-msg" })
                            </div>
                        </div>
                        <div class="col-xs-3">
                            <div class="form-group">
                                <label>To Date:</label>
                                @Html.TextBoxFor(model => model.ToDate, "{0:dd MMM yyyy}", htmlAttributes: new { placeholder = "Select To Date", @class = "form-control form-control-custom ToD", autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.ToDate, "", new { @class = "text-danger validation-msg" })
                            </div>
                        </div>
                        @*added by ruchita for obs bind on on 02042024*@
                        <div class="col-xs-3">
                            <div class="form-group">
                                <label>OBS</label>
                                <input type="hidden" id="selectedValues" name="selectedValues" />

                                <select id="OBS" class="form-control form-multiselect-OBS" multiple="multiple" name="OBS" placeholder="Select Option">
                                    @{

                                        if (ViewData["OBSType"] != null)
                                        {
                                            if (ViewData["selected"] == null)
                                            {
                                                foreach (var item in ViewData["OBSType"] as IEnumerable<SelectListItem>)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            }
                                            else
                                            {
                                                foreach (var item in ViewData["OBSType"] as IEnumerable<SelectListItem>)
                                                {
                                                    bool isSelected = ViewData["selected"] != null && (ViewData["selected"] as string ?? "").Split(',').Contains(item.Value);

                                                    <option value="@item.Value" @(isSelected ? "selected" : "")>@item.Text</option>
                                                }

                                            }
                                        }

                                    }
                                </select>
                            </div>

                        </div>
                        <div class="col-xs-3">
                            <div class="form-group">
                                <button type="submit" class="btn btn-info dynamic-function-btn dynamic-function-btn-2" style="margin-top: 24px;">Search</button>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
            </div>
            @*<div class="col-lg-12">
                <div class="col-xs-12">
                    <table class="table table-bordered" id="example">
                        <thead>
                            <tr>
                                @foreach (System.Data.DataColumn column in ViewBag.BodyData.Columns)
                                {
                                    <th>@column.ColumnName</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (System.Data.DataRow row in ViewBag.BodyData.Rows)
                           {
                                <tr>
                                    @foreach (System.Data.DataColumn column in ViewBag.BodyData.Columns)
                                    {
                                        <td>@row[column.ColumnName]</td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>*@
@*code added by ruchita on 02042024*@
<div class="col-lg-12">
    <div class="col-xs-12">
        <table class="table table-bordered" id="example">
            <thead>
                <tr>
                    <th rowspan="2" style="width: 180px;word-wrap: break-word;font-family:'TNG Pro';padding:58px;font-weight:normal;transform: rotate(180deg);" class="slanted-heading_">@ViewBag.BodyData.Columns[0].ColumnName</th>
                    @foreach (System.Data.DataColumn column in ViewBag.BodyData.Columns)
                    {
                        if (column.Ordinal != 0)
                        {
                            <th style="transform: rotate(180deg);" class="slanted-heading_">
                                <p style="transform: rotate(360deg);margin-top: 46px; font-family: 'TNG Pro';">@column.ColumnName</p>
                            </th>
                        }
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (System.Data.DataRow row in ViewBag.BodyData.Rows)
                {
                    <tr>
                        <td>@row[0]</td>
                        @foreach (System.Data.DataColumn column in ViewBag.BodyData.Columns)
                        {
                            if (column.Ordinal != 0)
                            {
                                <td>@row[column.ColumnName]</td>
                            }
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>



        </div>
    </div>
}


<script type="text/javascript">
    $(document).ready(function () {
        $("#btnSearch").click(function myfunction() {
            debugger;
            if (ValidateForm() == false) {
                return false;
            }
            else {
                $("#form1").submit()
            }
        });
    });

    function ValidateForm() {

        if ($("#FromD").val() == "") {
            alert('Select From Date!');
            return false;
        }
        if ($("#ToD").val() == "") {
            alert('Select To Date!');
            return false;
        }
        debugger;
        if ($("#FromD").val() > $("#ToD").val()) {
            alert("To Date selected is Greater than From Date  !!!");
            return false;
        }

        else {
            return true;

        }
    }

    //added by ruchita for total column on 02042024
    $('#example thead th').each(function () {
        $(this).css({
            'transform': 'rotate(180deg)'
        });
        $(this).find('p').css({
            'transform': 'rotate(360deg)',
            'margin-top': '46px',
            'font-family': 'TNG Pro'
        });
    });
    $('#example thead tr').append('<th style="transform: rotate(180deg);" class="slanted-heading_"><p style="transform: rotate(360deg);margin-top: 46px; font-family: "TNG Pro";">Total</p></th>');


    $('#example tbody tr').each(function () {
        var total = 0;
        $(this).find('td').each(function (index) {
            if (index > 0) {
                total += parseInt($(this).text()) || 0;
            }
        });
        $(this).append('<td>' + total + '</td>');
    });
</script>


<script>
           [].forEach.call(document.getElementsByClassName('mvc-grid'), function (element) {
               new MvcGrid(element);
           });


            $('.mvc-grid-value').each(function (i)
            {
                    $(this).quicksearch("#gridMapping tr:not(:has(th))",
                    {
                        'testQuery': function (query, txt, row)
                        {
                            return $(row).children(":eq(" + i + ")").text().toLowerCase().indexOf(query[0].toLowerCase()) != -1;
                        }
                    });
            });


</script>
@*added by ruchita for multi select dropdown on 02042024*@
<script src="~/AllJsAndCss/js/bootstrap-multiselect.js"></script>
<link href="~/AllJsAndCss/css/bootstrap-multiselect.css" rel="stylesheet" />

<script>
    $('.form-multiselect-OBS').multiselect({
        enableFiltering: true,
        includeSelectAllOption: true,
        enableCaseInsensitiveFiltering: true
    });
    $(function () {
        $('#OBS').multiselect({
            includeSelectAllOption: true
        });

    });
</script>
<script>
    $(document).ready(function() {
        $('#OBS').change(function() {
            var selectedValues = $(this).val();
            $('#selectedValues').val(selectedValues);
           console.log( $('#selectedValues').val());
        });
    });
</script>
