@model TuvVision.Models.InspectionvisitReportModel
@{
    ViewBag.Title = "AllConcern";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
    int j = 0;
}

@*Ashwini Scripts here for datatable starts here*@
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/datatable/js/jquery.dataTables.js"></script>

<!--export to excel-->
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/jszip.min.js"></script>
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/buttons.html5.min.js"></script>
<script src="~/AllJsAndCss/js/datatable-custom2.js"></script>


<style>
    #customers1 {
        /*font-family: Arial, Helvetica, sans-serif;*/
        font-family: 'TNG Pro';
        border-collapse: collapse;
        width: 100%;
    }

    #customers td, #customers th {
        border: 1px solid #ddd;
        padding: 8px;
    }

    #customers tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    #customers tr:hover {
        background-color: #ddd;
    }

    #customers th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #3333ff;
        color: white;
    }
</style>

<style>
    #customers {
        /*font-family: Arial, Helvetica, sans-serif;*/
        font-family: 'TNG Pro';
        border-collapse: collapse;
        width: 100%;
    }

        #customers td, #customers th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #customers tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #customers tr:hover {
            background-color: #ddd;
        }

        #customers th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            /*background-color: #04AA6D;*/
            background-color: #001ED2;
            color: white;
        }
</style>
<style>
    #customers2 {
        /*font-family: Arial, Helvetica, sans-serif;*/
        font-family: 'TNG Pro';
        border-collapse: collapse;
        width: 100%;
    }

        #customers2 td, #customers2 th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #customers2 tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #customers2 tr:hover {
            background-color: #ddd;
        }

        #customers2 th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            /*background-color: #04AA6D;*/
            background-color: #001ED2;
          color: whi
<style>
    #customers2 {
        /*font-family: Arial, Helvetica, sans-serif;*/
        font-family: 'TNG Pro';
        border-collapse: collapse;
        width: 100%;
    }

        #customers2 td, #customers2 th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #customers2 tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #customers2 tr:hover {
            background-color: #ddd;
        }

        #customers2 th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            /*background-color: #04AA6D;*/
            background-color: #001ED2;
            color: white;
        }
</style>

@using (Html.BeginForm("AllConcern", "VisitReport", FormMethod.Post, new { enctype = "multipart/form-data", @id = "formiid" }))



{

    <div class="main-content3 xs-max-height">

        <!--Start of header-->
        @*<input id="GridSearch" />*@


        <div class="container-fluid">
            <div class="row assignfixedwidth rp-15">

                <div class="col-xs-12">
                    @if (Model.Type == "InspectorCall")
                {

                }
                else
                {
                        <h5 class="dynamic-page-title dynamic-page-title-2 " style="padding-left: 11px;">Inspection Visit Report Number : @Session["VisitReportNo"]</h5>
                    }



                    <button type="button" id="a" value="ExportToExcel" class="btn btn-info dynamic-function-btn dynamic-function-btn-2" onclick="location.href='@Url.Action("ExportIndex1", "VisitReport",new { @PK_Call_ID= Model.PK_Call_ID })'"
                            style="border:none;">
                        Export To Excel
                    </button>



                </div><!-- /.col -->

                <div class="col-xs-12">
                    @Html.HiddenFor(m => m.PK_Call_ID)
                    @Html.HiddenFor(m => m.Type)
                    @Html.HiddenFor(m => m.abcid)
                    @if (Model.Type == "InspectorCall")
                    {

                    }
                    else
                    {
                        if (Model.PK_Call_ID != 0)
                        {
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("VisitReportForm", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">General</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("ItemDescription", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Item Description</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("ReferenceDocuments", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Reference Documents</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("InspectionActivites", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Stages Witnessed</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("DocumentReviewed", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Document Reviewed</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("EquipmentDetails", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Details Of Measuring Instrument</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("Conclusion", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Conclusion</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("ReportImage", "VisitReport", new { @PK_Call_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Image</button>
                            <button class="btn btn-default news-btn" type="button" onclick="location.href='@Url.Action("IvrReports", "VisitReport", new { @PK_CALL_ID = Model.PK_Call_ID,@PK_RM_ID = Model.abcid })'">Report</button>
                            <button class="btn btn-default insert-form-btn" type="button" onclick="location.href='@Url.Action("AllConcern", "VisitReport", new { @PK_CALL_ID = Model.PK_Call_ID, @PK_RM_ID = Model.abcid })'">List of Issues</button>
                        }
                    }



                </div>



                @*<div class="col-xs-12">
                        <hr class="custom-hr">
                    </div>*@
                <!--Table was here-->

                <div class="col-xs-12">
                    <hr class="custom-hr1">
                </div>
                <div class="col-xs-12">
                    <h3 class="dynamic-page-title dynamic-page-title-2  text-left">History:</h3>
                </div>
                <div class="col-xs-12">
                    @Html.HiddenFor(m => m.PK_Call_ID)
                    <table id="customers2" class="display custom-table" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th width="10%">Date</th>
                                <th width="20%">No</th>
                                <th width="15%">Inspector Name</th>
                                <th width="30%">Issuer Comments</th>
                                <th width="25%">Issued for PO Items No'(s)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="hidden">
                                <td>Date</td>
                                <td><strong>No</strong></td>
                                <td>Inspector Nam</td>
                                <td>Issuer Comments</td>
                                <td>Issued for PO Items No'(s)</td>
                            </tr>
                            <tr class="hidden">

                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>

                            </tr>

                            @foreach (var item in ViewData["AllHistoryIVR"] as IEnumerable<TuvVision.Models.InspectionvisitReportModel>)
                            {
                                <tr>
                                    <td width="10%">@item.Date_Of_Inspection</td>
                                    <td width="20%">@item.ReportName</td>
                                    <td width="15%">@item.Name</td>
                                    <td width="30%">@item.PODescription</td>
                                    <td width="25%">@item.POItems</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <br />
                    <br />
                </div>
                <br />
                <div class="col-xs-12">
                    <hr class="custom-hr1">
                </div>
                <div class="col-xs-12">
                    <h3 class="dynamic-page-title dynamic-page-title-2  text-left">Open Issues:</h3>
                </div>
                @Html.HiddenFor(m => m.PK_Call_ID)
                <div class="col-xs-12">
                    <table id="customers" class="display custom-table" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                @*<th class="remove-search less-width">Action</th>*@
                                <th width="5%">Type</th>
                                <th width="25%">Description</th>
                                <th width="25%">Mitigated By</th>
                                <th width="25%">Mitigated Date</th>
                                <th width="10%">Raised By</th>
                                <th width="10%">Re-Opened By</th>
                                <th width="10%">Download Report</th>
                                <th width="15%">Previous Comments</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr class="hidden">
                                @*<th class="remove-search less-width"></th>*@

                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                            <tr class="hidden">
                                @*<td></td>*@
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>

                            @*@foreach (var item in ViewData["AllConcerns"] as IEnumerable<TuvVision.Models.InspectionvisitReportModel>)*@
                            @foreach (var item in ViewBag.AllConcerns as IEnumerable<TuvVision.Models.InspectionvisitReportModel>)
                            {
                                string bgColor = string.Empty;

                                if (item.Type.ToUpper() == "AREA OF CONCERN")
                                {
                                    bgColor = "#FFFBCC";
                                    // bgColor = "red";

                                }
                                else if (item.Type.ToUpper() == "NON CONFORMITY")
                                {
                                    bgColor = "#FED7DA";
                                }
                                else if (item.Type.ToUpper() == "PENDING ACTIVITY")
                                {
                                    bgColor = "#CCFBF4";
                                }
                                /// bgColor = "red";
                                <tr class="tddata" style="background-color:@bgColor">
                                    @Html.HiddenFor(model => model.Concern[j].PkId, new { @placeholder = "ID", @Value = item.PkId, @class = "form-control" })
                                    @Html.HiddenFor(model => model.Concern[j].Type, new { @Value = item.Type ,@class = "form-control" })
                                    @Html.HiddenFor(model => model.Concern[j].PK_IVR_ID, new { @Value = item.PK_IVR_ID, @class = "form-control" })
                                    @*<td>
                                        @Html.CheckBoxFor(model => model.Concern[j].POTotalCheckBox, new { @placeholder = "", id = "v", Class = "form-control" })

                                                                          </td>*@
                                    <td width="5%">@item.Type</td>
                                    <td width="25%">@item.Areas_Of_Concerns</td>
                                    <td width="25%">
                                        @Html.TextAreaFor(model => model.Concern[j].Reason, 3, 40, new { @placeholder = "Reason", id = "Reason", Class = "Reason" })
                                        @*<input type="text" name="Reason"  id="Reason" class="Reason" /></td>*@
                                    </td>
                                    <td>@Html.TextBoxFor(model => model.Concern[j].Mitigateddate, new { placeholder = "Select To Date", @class = "Mitigateddate", Type = "date", id = "Mitigateddate" })</td>
                                    <td width="10%">@item.Name</td>
                                    <td width="10%">@item.ReopenBy</td>
                                    <td width="10%">
                                        <a href="~/IVRReport/@item.Report_No" download="download">
                                            @item.Report_No

                                        </a>
                                    </td>
                                    <td width="15%">@item.Reason</td>
                                </tr>
                                j++;
                            }

                        </tbody>

                    </table>
                    <br />
                </div>
                <br />

                @if (Model.Type == "InspectorCall")
                {

                }
                else
                {

                    if (Model.AreasOfConcern == true)
                    {
                        <div class="col-xs-12">
                            <hr class="custom-hr1">
                        </div>

                        <div class="col-xs-12">
                            <label style="margin-left: 3px;color:#001ED2;"> Declaration:</label>
                            </div>
                            <div class="col-sm-12" style="pointer-events:none;">
                                <div class="col-xs-12">
                                    <div class="form-group" style="display: flex; align-items: center;">
                                        @Html.CheckBoxFor(model => model.AreasOfConcern)
                                        <label for="InActive" style="color:black; margin-left: 5px; margin-top: 0; padding-left: 10px;">I have reviewed and verified all the open issues listed in the table above. The vendor has not taken any action on these issues till date. Notes for the next visiting inspector are provided in the comment box below.</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12" style="pointer-events:none;">
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label></label>
                                        @Html.TextAreaFor(model => model.PODescription, 4, 40, htmlAttributes: new { placeholder = "Open Issues are related to PO Line item Numbers-", @class = "form-control", autocomplete = "off" })
                                        @Html.ValidationMessageFor(model => model.PODescription, "", new { @class = "text-danger validation-msg" })
                                    </div>

                                </div>
                            </div>
                    }
                    else
                    {
                        <div class="col-xs-12">
                            <hr class="custom-hr1">
                        </div>

                        <div class="col-xs-12">
                            <label style="margin-left: 3px;color:#001ED2;"> Declaration:</label>
                        </div>
                            <div class="col-sm-12">
                                <div class="col-xs-12">
                                    <div class="form-group" style="display: flex; align-items: center;">
                                        @Html.CheckBoxFor(model => model.AreasOfConcern)
                                        <label for="InActive" style="color:black; margin-left: 5px; margin-top: 0; padding-left: 10px;">I have reviewed and verified all the open issues listed in the table above. The vendor has not taken any action on these issues till date. Notes for the next visiting inspector are provided in the comment box below.</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12">
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label></label>
                                        @Html.TextAreaFor(model => model.PODescription, 4, 40, htmlAttributes: new { placeholder = "", @class = "form-control", autocomplete = "off" })
                                        @Html.ValidationMessageFor(model => model.PODescription, "", new { @class = "text-danger validation-msg" })
                                    </div>

                                </div>
                            </div>
                            }

                            }

                            <div class="col-xs-12 text-center">
                                <button type="submit" id="btnSave" name="btnSave" class="btn btn-default insert-form-btn"> Save </button>

                            </div>

                            <div class="col-xs-12">
                                <hr class="custom-hr1">
                            </div>
                            <div class="col-xs-12">
                                <h3 class="dynamic-page-title dynamic-page-title-2  text-left">Closed Issues:</h3>
                            </div>
                            @*<hr class="custom-hr">*@
                            <br />

                            <div class="col-xs-12">

                                @Html.HiddenFor(m => m.PK_Call_ID)
                                <table id="customers" cellspacing="0">
                                    <thead>
                                        <tr>

                                            <th width="5%">Type</th>
                                            <th width="25%">Description</th>
                                            <th width="25%">Mitigated By</th>
                                            <th width="25%">Mitigated Date</th>
                                            <th width="10%">Raised By</th>
                                            <th width="10%">Closed By</th>
                                            <th width="15%">Report</th>
                                            <th class="hidden">Id</th>
                                            <th width="10%"></th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr class="hidden">


                                            <td>Type</td>
                                            <td><strong>Description</strong></td>
                                            <td>Mitigated By</td>
                                            <td>Mitigated Date</td>
                                            <td>Close By</td>
                                            <td>Report</td>
                                            <td class="hidden">PkId</td>
                                            <td>Action</td>
                                        </tr>
                                        <tr class="hidden">

                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>

                                        @foreach (var item in ViewData["AllCloseConcerns"] as IEnumerable<TuvVision.Models.InspectionvisitReportModel>)
                                        {
                                            <tr>

                                                <td width="5%">@item.Type</td>
                                                <td width="25%">@item.Areas_Of_Concerns</td>
                                                <td width="25%">@item.Reason</td>
                                                <td width="25%">@item.Mitigateddate</td>
                                                <td width="10%">@item.CreatedBy</td>

                                                <td width="10%">@item.Name</td>


                                                <td width="15%">
                                                    <a href="~/IVRReport/@item.Report_No" download="download">
                                                        @item.Report_No
                                                    </a>
                                                </td>
                                                <td class="hidden">@item.PkId</td>
                                                @if (@item.Type == "Non Conformity")
                                                {
                                                    <td width="10%"></td>
                                                }
                                                else
                                                {
                                                    <td width="10%">
                                                        @Html.ActionLink("ReOpen", "OpenConcern", new
                                       {
                                           PkId = @item.PkId,
                                           @class = "saveButton",
                                           PK_Call_ID = Model.PK_Call_ID@*, Type = "InspectorCall"*@ }, new { onclick = "return confirm('Are you sure you wish to Re-Open this ?');" })
                                                    </td>
                                                }

                                            </tr>
                                        }

                                    </tbody>

                                </table>


                                <br />
                                <br />
                            </div>


                            <div class="col-xs-12">
                            </div>
                            @*<div class="col-xs-12">
                                    <h3 class="dynamic-page-title dynamic-page-title-2  text-left">Non Confirmatory Reports:</h3>
                                </div>
                                <br />*@

                            @*<div class="col-xs-12">
                                    @Html.HiddenFor(m => m.PK_Call_ID)
                                    <table id="customers" cellspacing="0" width="100%">
                                        <thead>
                                            <tr>


                                                <th width="80%">NCR</th>

                                                <th width="10%">Status</th>
                                                <th width="10%">NCR Raised By</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr class="hidden">


                                                <td><strong>NCR</strong></td>
                                                <td>Status</td>
                                                <td>NCR Raised By</td>

                                            </tr>
                                            <tr class="hidden">

                                                <td></td>
                                                <td></td>
                                                <td></td>

                                            </tr>

                                            @foreach (var item in ViewData["NCR"] as IEnumerable<TuvVision.Models.InspectionvisitReportModel>)
                                            {
                                                <tr>





                                                    <td width="80%">
                                                        <a href="@Url.Action("CreateNCR", "NCR",
                                  new {@Type = "AllConcern", @Id = @item.NCRID,@PK_Call_Id=Model.PK_Call_ID })">

                                                            @item.Non_Conformities_raised
                                                        </a>
                                                    </td>
                                                    <td width="10%">@item.Status</td>
                                                    <td width="10%">@item.CreatedBy</td>
                                                                              </tr>
                                            }

                                        </tbody>

                                    </table>



                                </div>*@



                        </div>
        </div>
        <!--End of header-->

    </div>

    <script>
        $(document).ready(function () {
            $('.saveButton').click(function () {
                $(this).closest('form')[0].submit();
            });
        });
    </script>

    <!--End of Ashwini Code-->
    @*<script>

            $("#btnSave").click(function () {
                debugger;


                var a = $('input:checkbox:checked').length;
                if (a=="0")
                {
                    alert("Plese Select Checkbox");
                    return false;
                }
                else
                {
                    $("input:checkbox[class='single-checkbox1']:checked").each(function () {


                    for ( var i = 0; i = $('input:checkbox:checked').length;  i++ )
                    {


                        if ($('#v').is(":checked"))
                        {
                            var b=$('#Reason').val();
                            if(b="")
                            {
                                return false;
                            }
                            else
                            {

                            }
                        }
                        else
                        {

                        }
                    }


                    })
                }
            });
        </script>*@

}

<script>

    $("#btnSave").click(function () {
        debugger;
        var trD = {};
        var b = "1";
        $('.tddata').each(function () {

            var Reason = $(this).find('#Reason').val();
            var Mitigateddate = $(this).find('#Mitigateddate').val();
            if (Reason != null && Reason != '') {
                if (Mitigateddate == '') {
                    $("#Mitigateddate").focus();
                    b = "2";
                    alert("Please Enter Mitigated date!");
                    return false;
                }
                else {

                }

            }
            else {

            }
        });
        if (b == "2") {

            $("#Mitigateddate").focus()
            return false;
        }
        else {
            $("#form1").submit();
            return true;
        }
    });
</script>


<script type="text/javascript">
    $(document).ready(function () {
        $('#customers2').DataTable({
            "paging": true, // Enables pagination
            "searching": true, // Enables search
            "lengthChange": true, // Allows the user to change the number of rows per page
            "pageLength": 10 // Sets the number of rows per page by default
        });
    });
</script>

