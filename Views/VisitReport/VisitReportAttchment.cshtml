@model TuvVision.Models.InspectionvisitReportModel
@{
    ViewBag.Title = "VisitReportAttchment";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
}

<script type="text/javascript" language="javascript" src="~/AllJsAndCss/datatable/js/jquery.dataTables.js"></script>
<script src="~/AllJsAndCss/datatable/js/jquery.dataTables.js"></script>
<script src="~/AllJsAndCss/js/datatable-custom.js"></script>
<div class="main-content3 xs-max-height grey-bg-f3">
    <div class="grey-bg-f3">
        <!--Start of header-->
        <div class="container-fluid">
            <div class="row assignfixedwidth rp-5">

                <div class="col-xs-12 form-col">
                    <div class="row">

                        <h3 class="dynamic-page-title dynamic-page-title-2">Visit Report Attachment</h3>
                        <a href="@Url.Action("CallsListByInspector","CallsMaster")" class="btn btn-info dynamic-function-btn dynamic-function-btn-2"><i class="fa fa-long-arrow-left"></i> Go Back</a>

                        <div class="col-xs-12 text-right">


                            @if (Model.PK_Call_ID != 0)
            {
                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("VisitReportForm", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'"> General</button>
                               
                                <button class="btn btn-primary btn-lg active" type="button" onclick="location.href='@Url.Action("ItemDescription", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Item Description</button>

                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("ReferenceDocuments", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Reference Documents</button>
                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("InspectionActivites", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Stages Witnessed</button>
                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("DocumentReviewed", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Document Reviewed</button>
                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("EquipmentDetails", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Details Of Measuring Instrument</button>
                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("Conclusion", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Conclusion</button>

                                <button class="btn btn-info dynamic-function-btn" type="button" onclick="location.href='@Url.Action("ReportImage", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Image</button>

                                <button class="btn btn-primary btn-lg active" type="button" onclick="location.href='@Url.Action("VisitReportAttchment", "VisitReport",new { @PK_Call_ID = Model.PK_Call_ID} )'">Attachment</button>

                            }



                        </div>


                        <div class="col-xs-12">
                            <div class="white-bg section-box-shadow">
                                <h3 class="form-page-title">Visit Report Attachment</h3>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-offset-1 col-sm-10">
                                        <div class="form-box">
                                            <form method="post" enctype="multipart/form-data">

                                                @Html.HiddenFor(m => m.PK_Call_ID)
                                                <div class="row">

                                                    <div class="col-xs-12">
                                                        <div class="form-group">
                                                            <label><i class="fa fa-paperclip" style="color:black;"></i> Related Documents (Please attach files here) : <span style="color:#ff0000;">*</span></label>
                                                            <input type="file" class="filepond" name="filepond" id="FileUpload" multiple>
                                                            <input hidden="hidden" id="hdfFileUpload" name="FileUpload" class="hidden" />
                                                        </div>
                                                    </div>
                                                    <div class="col-xs-12">
                                                        <div class="form-group">
                                                            @{
                                                                            int i ;
                                                                            if (Model != null)
                                                                            {

                                                                                if (!string.IsNullOrEmpty(Model.VisitReportAttachment))
                                                                                {
                                                                        <div class="cform-group">
                                                                            @{
                                                                                string[] words = (Model.VisitReportAttachment).Split(',');
                                                                                for(i = 0; i < words.Count(); i++)
                                                                                {
                                                                                    <a id="btnAddToCart" class="btn btn-default insert-form-btn" href="@Url.Content("" + words[i])" role="button" download="@Url.Content("~/Content/Uploads/Images/" + words[i])">


                                                                                        <i class="fa fa-download"></i>           @words[i]
                                                                                    </a>
                                                                                }
                                                                }
                                                                        </div>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <div class="form-group">

                                                                                    </div>
                                                                                    }
                                                                                }
                                                            }
                                                        </div>
                                                    </div>




                                                </div>


                                                <div class="col-xs-12 text-center">
                                                    
                                                    <button type="submit" class="btn btn-default insert-form-btn"><i class="fa fa-plus-circle"></i>Save</button>

                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <!--Contact Details By Manoj -->
                                <div class="row">
                                    @*<div class="col-xs-12 col-sm-offset-1 col-sm-10">*@
                                    <div class="col-xs-12">
                                        <div class="col-xs-12">
                                            <table id="example" class="display custom-table" cellspacing="0" width="100%">
                                                <thead>
                                                    <tr>
                                                        <th class="remove-search">Attachment</th>
                                                        
                                                    </tr>
                                                </thead>

                                                <tbody>

                                                    @{
                                                        int j = 0;
                                                    }
                                                    @foreach (var item in ViewData["CostSheet"] as IEnumerable<TuvVision.Models.ItemDescriptionModel>)
                                                    {
                                                        <tr>


                                                            <td>@item.Po_Item_No</td>
                                                            

                                                        </tr>
                                                                    }

                                                </tbody>

                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div><!-- /.box-shadow -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/AllJsAndCss/js/filepond.js"></script>

<!-- Turn all file input elements into ponds -->
<script>
    FilePond.parse(document.body);
</script>

<script>
    var SummaryExtension = false;
    var fileExtension = ["pdf", "PDF", "xls", "xlsx", "doc", "DOC", "docx", "DOCX", "png", "PNG", "jpg", "JPG", "JPEG", "gif"];
    $("#FileUpload").change(function (e) {
        debugger;
        var files = $("#FileUpload input[type='file']").get(0).files;
        for (var index = 0; index < files.length; index++)
        {
            var singleExtension = e.target.files[index].name.split('.').pop();
            var Condition = fileExtension.includes(singleExtension);
            if (Condition == true)
            {
                SummaryExtension = true;
            }
            else
            {
                alert("Only formats are allowed : " + fileExtension.join(','));
                SummaryExtension = false;
                return;
            }
        }
        if (SummaryExtension == true)
        {
            var fileData = new FormData();
            for (var i = 0; i < files.length; i++)
            {
                fileData.append("FileUpload input[type='file']", files[i]);
            }
            //Creating an XMLHttpRequest and sending
            var xhr = new XMLHttpRequest();
            var link = '@Url.Action("TemporaryFilePathVisitReportAttchment", "VisitReport")';
            xhr.open('POST', link, 'true');
            xhr.send(fileData);
            xhr.onreadystatechange = function ()
            {
                if (xhr.readyState == 4 && xhr.status == 200)
                {
                    var data = xhr.responseText;
                    data = data.replace(/"/g, "");
                    $("#Attachment").val(data);
                }
            }
            //})
        }



    })
</script>  

