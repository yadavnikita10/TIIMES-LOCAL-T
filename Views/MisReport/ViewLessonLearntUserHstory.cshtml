@model TuvVision.Models.LessionLearntModel
@using NonFactors.Mvc.Grid;
@using System.Web.Mvc;
@using System.Configuration;

@{
    ViewBag.Title = "LessonLearnt";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
}
<style>
    .ifa {
        pointer-events: none;
    }

    .dataTables_filter, .dataTables_info {
        display: none;
    }

    .tooltip-inner {
        max-width: 300px !important;
    }
</style>

<div class="main-content3 xs-max-height">

    <!--Start of header-->
    <div class="container-fluid">
        <div class="row assignfixedwidth rp-15">

            <!-- /.col -->
            <!--Table was here-->
            <div class="col-xs-12">
                <div class="col-xs-12 col-sm-4">

                    <h3 class="dynamic-page-title dynamic-page-title-2  text-left">Lesson Learnt History</h3>

                </div>


            </div>
            <div class="col-xs-12">
                <hr class="custom-hr">
            </div><!-- /.col -->
        </div>






        <div class="col-xs-12">
            <table id="example" class="display" cellspacing="0" width="100%">
                <thead>
                    <tr>

                        <th>UIN</th>
                        <th>Declaration</th>
                        <th>Unique number </th>
                        <th>From </th>
                        <th>Category</th>
                        @*<th>Employment Category</th>*@
                        <th>Description</th>
                        <th>View</th>
                        <th>RCA </th>
                        <th>Lessons Learnt</th>
                        @*<th>Lession Learnt View</th>*@
                        <th>Lessons Learnt View</th>
                        <th>Shared on</th>

                    </tr>
                </thead>

                <tbody>
                    @if (Model.dtLessionLeant != null && Model.dtLessionLeant.Rows.Count != 0)
                    {
                        for (
                            int cnt = 0; cnt < Model.dtLessionLeant.Rows.Count; cnt++)
                        {
                            System.Data.DataRow row = Model.dtLessionLeant.Rows[cnt];
                            <tr>

                                <td align="left">@row["LessionLeantNumber"]</td>
                                <td>
                                    @Html.ActionLink("View", "ViewLessonLearntUserDetail", new { ID = Convert.ToInt32(@row["LessonsLearnt_ID"]) })

                                </td>
                                <td align="left">@row["Complaint_No"]</td>
                                <td align="left">@row["FromTable"]</td>
                                <td align="left">@row["Category"]</td>
                                <td align="left">
                                    @*<button type="button" class="btn btn-secondary" data-toggle="tooltip" data-placement="right" title="@row["Description"]">
                                        <img src="~/View1.png" />
                                    </button>*@
                                    <span class="tooltip-container" data-toggle="tooltip" data-placement="top" title="@row["Description"]"> <img src="~/View1.png" /></span>
                                </td>
                                @if (row["ComplaintImages"] != null && row["ComplaintImages"].ToString() != "")
                                {
                                    var attach6 = row["ComplaintImages"].ToString().Split(',');

                                    <td align="left">
                                        @for (int ar1 = 0; ar1 < attach6.Length; ar1++)
                                        {
                                            var attach6PCert = attach6[ar1].ToString().Split('|');
                                            <li>
                                                @*<a onclick="openPopUp(this)" fileid="@attach6PCert[1].ToString()" tabletype="@row["FromTable"]"><img src="~/View1.png" /></a>*@<a class="title" href="@Url.Action("Download1", "MISReport", new { @d = attach6PCert[1].ToString(),@TableType = row["FromTable"] })"><img src="~/View1.png" /></a>
                                            </li><br />
                                        }
                                    </td>
                                }
                                else
                                {
                                    <td align="left">&nbsp;</td>
                                }

                                <td>
                                    @*td align="left" title="@row["RCA"]"><img src="~/View1.png" />*@
                                    @*<button type="button" class="btn btn-secondary" data-toggle="tooltip" data-placement="right" title="@row["RCA"]">
                                        <img src="~/View1.png" />
                                    </button>*@
                                    <span class="tooltip-container" data-toggle="tooltip" data-placement="top" title="@row["RCA"]"> <img src="~/View1.png" /></span>
                                </td>

                                <td align="left">@row["LessonLearned"]</td>

                                @if (row["LessionLearntImages"] != null && row["LessionLearntImages"].ToString() != "")
                                {
                                    var attach6 = row["LessionLearntImages"].ToString().Split(',');

                                    <td align="left">
                                        @for (int ar1 = 0; ar1 < attach6.Length; ar1++)
                                        {
                                            var attach6PCert = attach6[ar1].ToString().Split('|');
                                            <li>
                                                @*<a onclick="openPopUp(this)" fileid="@attach6PCert[1].ToString()" tabletype="@row["FromTable"]"><img src="~/View1.png" /></a>*@
                                                @*<a onclick="openPopUp(this)" fileid="@attach6PCert[1].ToString()" tabletype="@row["FromTable"]">@attach6PCert[0].ToString()</a>*@
                                                <a class="title" href="@Url.Action("Download1", "MISReport", new { @d = attach6PCert[1].ToString(),@TableType = row["FromTable"] })"><img src="~/View1.png" /></a>
                                            </li><br />
                                        }
                                    </td>
                                }
                                else
                                {
                                    <td align="left">&nbsp;</td>
                                }
                                <td align="left">
                                    @row["SharedDate"]
                                    @Html.Hidden(@row["LessonsLearnt_ID"].ToString())
                                </td>
                              

                            </tr>
                        }
                    }

                </tbody>

            </table>

        </div>
    </div>

</div>
<div class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-fullscreen" role="document" style="width:100%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">View Attachment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="height:500px">
                <iframe id="_iframe" style="width:100%;height:100%"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/datatable/js/jquery.dataTables.js"></script>


<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/dataTables.buttons.min.js"></script>
@*<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/jszip.min.js"></script>*@
<script type="text/javascript" language="javascript" src="~/AllJsAndCss/js/buttons.html5.min.js"></script>
<script src="~/AllJsAndCss/js/datatable-custom2.js"></script>

<script>
    //disable con+s button
    $(document).bind('keydown', function (e) {
        if (e.ctrlKey && (e.which == 83)) {
            alert("contr + s disabled");
            e.preventDefault();
            return false;
        }
    });

    function openPopUp(e) {

        var fileid = $(e).attr('fileid');
        var tabletype = $(e).attr('tabletype');

        $.ajax({
            url: '@Url.Action("Download1", "MisReport")',
            type: 'post',
            datatype: 'json',
            data: { d: fileid, TableType: tabletype },
            success: function (result) {
                $("#_iframe").attr("src", `${result}#toolbar=0`);
                $(".modal").modal('show');
                setTimeout(() => {
                    console.log(document.getElementById('download'));
                },3000)
            },
            error: function (result) {

            }

        });




    }
</script>


<script>

    $(document).ready(function () {
        $(".complaint").addClass('d-none');
        setTimeout(() => {
            $('.complaint').removeClass('d-none');
            $('.complaint').addClass('d-block');
            console.log('Button Activated')
        }, 20000)

    })

</script>
