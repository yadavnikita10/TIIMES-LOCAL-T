@model TuvVision.Models.UserRoles
@{
    ViewBag.Title = "CreateRole";
    Layout = "~/Views/Shared/_TuvVision.cshtml";
}

<!DOCTYPE HTML>
<html>

<head>
    <title>Create Role</title>
    @*Multiselected ddl*@
    <script src="~/Scripts/MultiSelectddl/select2.min.js"></script>
    <link href="~/Content/MultiSelectddl/select2.min.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            $("#MenuNameList").select2({
                maximumSelectionLength: 10,
                placeholder: "---Select Menu Name---"
            })
            $("#SubMenuNameList").select2({
                maximumSelectionLength: 10,
                placeholder: "---Select Sub Menu Name---"
            })
        });
    </script>
    @{
        List<string> Menus = ViewBag.Menus as List<string>;
        List<string> SubMenus = ViewBag.SubMenus as List<string>;
    }
</head>
<body>

    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        <div class="grey-bg-f3">

            <!--Start of header-->
            <div class="container-fluid">
                <div class="row assignfixedwidth rp-5">

                    <div class="col-xs-12 form-col">
                        <div class="row">

                            <div class="col-xs-12 text-right">
                                <a href="@Url.Action("RoleDashBoard", "UserRole")" class="btn btn-info dynamic-function-btn"><i class="fa fa-long-arrow-left"></i> Go Back</a>
                            </div>

                            <div class="col-xs-12">
                                <div class="white-bg section-box-shadow">
                                    <h3 class="form-page-title">New Role Creation</h3>

                                    @Html.HiddenFor(model => model.UserRoleID)
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-offset-1 col-sm-10">
                                            <div class="form-box">
                                                <form>
                                                    <div class="col-xs-12 col-sm-6">
                                                        <div class="form-group">
                                                            <label>Role Name:</label>
                                                            @Html.TextBoxFor(model => model.RoleName, new { placeholder = "Role Name Here", @class = "form-control" })
                                                        </div>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        <div class="form-group">
                                                            <label>Description:</label>
                                                            @Html.TextBoxFor(model => model.Description, new { placeholder = "Description Here...", @class = "form-control" })
                                                            @*@Html.TextAreaFor(model => model.Description, new { placeholder = "Type description here...", @class = "form-control", @rows = "1" })*@
                                                        </div>
                                                    </div>
                                                    <div class="col-xs-12">
                                                        <div class="form-group">
                                                            <label>Menu Rights:</label>
                                                            @{
                                                                if (ViewBag.MenuName != null)
                                                                {
                                                                    <select id="MenuNameList" class="limitedNumbSelect2 form-control col-md-7 col-xs-12 multiselect-ddl" multiple="multiple" name="rolename" placeholder="Select Option" required="required">
                                                                        @{
                                                                            if (ViewBag.MenuNameGrup == null)
                                                                            {
                                                                                foreach (var item in ViewBag.MenuName)
                                                                                {
                                                                                    <option value="@item.Code">@item.Name</option>
                                                                                }
                                                                            }
                                                                        }

                                                                    </select>
                                                                            }
                                                                            else
                                                                            {
                                                                                <select id="MenuNameList" class="limitedNumbSelect2 form-control multiselect-ddl" multiple="multiple" name="rolename" placeholder="Select Option" required="required">
                                                                                    @{
                                                                                        foreach (var item in ViewBag.MenuNameGrup)
                                                                                        {
                                                                                            if (Menus.Contains(item.Text))
                                                                                            {
                                                                                                <option value="@item.Value" selected>@item.Text</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value="@item.Value">@item.Text</option>
                                                                                            }

                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                        }
                                                            }
                                                        </div>
                                                    </div>
                                                    <div class="col-xs-12">
                                                        <div class="form-group">
                                                            <label>Sub Menu Rights:</label>
                                                            @{
                                                                if (ViewBag.SubMenuName != null)
                                                                {
                                                                    <select id="SubMenuNameList" class="limitedNumbSelect2 form-control col-md-7 col-xs-12 multiselect-ddl" multiple="multiple" name="rolename" placeholder="Select Option" required="required">
                                                                        @{
                                                                            if (ViewBag.SubMenuNameGrup == null)
                                                                            {
                                                                                foreach (var item in ViewBag.SubMenuName)
                                                                                {
                                                                                    <option value="@item.Code">@item.Name</option>
                                                                                }
                                                                            }
                                                                        }

                                                                    </select>
                                                                            }
                                                                            else
                                                                            {
                                                                                <select id="SubMenuNameList" class="limitedNumbSelect2 form-control multiselect-ddl" multiple="multiple" name="rolename" placeholder="Select Option" required="required">
                                                                                    @{
                                                                                        foreach (var item in ViewBag.SubMenuNameGrup)
                                                                                        {
                                                                                            if (SubMenus.Contains(item.Text))
                                                                                            {
                                                                                                <option value="@item.Value" selected>@item.Text</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value="@item.Value">@item.Text</option>
                                                                                            }

                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                        }
                                                            }
                                                        </div>
                                                    </div>

                                                            <div class="col-xs-12 text-center">
                                                                <button type="button" class="btn btn-default news-btn" id="btnReset" value="Reset" title="Reset">Reset</button>
                                                                <input type="submit" value="Submit" class="btn btn-default insert-form-btn" id="btnGroups" />
                                                            </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div><!-- /.col -->

                        </div><!-- /.row -->
                    </div><!-- /.col -->

                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
            <!--End of header-->

        </div>
                                                                                            //EndContext of Ashwini's design


                                                                                            //MyCode start here
                                                                                            //MyCode Ends here

                                                                                        }
</body>
</html>

    }
@****************************************************************************Script Started Here********************************************************@
<script>
    $(document).ready(function () {

        $("#btnGroups").click(function () {
            debugger;
            var UserRoleID = $("#UserRoleID").val();
            var RoleName = $("#RoleName").val();
            var Description = $("#Description").val();

            var selected = $("#MenuNameList option:selected");
            var ddlMenuValue = "";
            selected.each(function () {
                ddlMenuValue += $(this).text() + ",";
            });
            var selected = $("#SubMenuNameList option:selected");
            var ddlSubMenuValue = "";
            selected.each(function () {
                ddlSubMenuValue += $(this).text() + ",";
            });

            if ($("#RoleName").val() == "" || $("#RoleName").val() == null) {
                alert("Please Enter Role Name !!!");
                $("#RoleName").focus();
                return false;
            }

            if (ddlMenuValue == 0 || ddlMenuValue == null) {
                alert("Please Select at least 1 Option Of Menu!!!");
                $("#MenuName").focus()
                return false;
            }

            else {
                if (true) {
                    var RoleDtls =
                    {
                        UserRoleID: UserRoleID,
                        RoleName: RoleName,
                        Description: Description,
                    }

                    $.ajax({
                        url: '@Url.Action("CreateRole", "UserRole")',
                        type: "POST",
                        //data: JSON.stringify({ UR: RoleDtls, "MenuName": ddlMenuValue, "SubMenuName": ddlSubMenuValue }),
                        data: JSON.stringify({ UR: RoleDtls, "MenuName": ddlMenuValue, "SubMenuName": ddlSubMenuValue }),
                        enctype: "multipart/form-data",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                            if (response == "Success") {
                                alert("Role has been Created successfully !!!");
                                $('#RoleName').val('');
                                $("#Description").val('');
                                $('#NumberOfDays').val('');
                                $('#GroupName').val('')
                                $('#MenuName').val('')
                                window.location.href = '@Url.Action("RoleDashBoard", "UserRole")';
                            }
                            if (response == "UpdateSuccess") {
                                alert("Role has been Updated successfully !!!");
                                $('#RoleName').val('');
                                $("#Description").val('');
                                $('#NumberOfDays').val('');
                                $('#GroupName').val('')
                                $('#MenuName').val('')
                                window.location.href = '@Url.Action("RoleDashBoard", "UserRole")';
                            }
                            if (response == "Failed") {
                                alert("Failed !!!  Role Not Created, Something Went Wrong!!!");
                                window.location.href = '@Url.Action("CreateRole", "UserRole")';
                            }
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });
                }

            }
        });
    });
</script>
@*Enabled and Dissabled Dropdownlist*@  @*CODE WILL BE USED IN FUTURE*@
<script>
        $(document).ready(function () {
            $("#SubMenuNameList").prop("disabled", true);
            $("#MenuNameList").change(function ()
            {
                var selected = $("#MenuNameList option:selected");
                var ddlSubMenuEnabledDisabled = "";
                selected.each(function ()
                {
                    ddlSubMenuEnabledDisabled += $(this).text() + ",";
                });
                var ddlSubMenuCalls = ddlSubMenuEnabledDisabled.indexOf("My Activity") !== -1;
                if (ddlSubMenuCalls == true)
                {
                    $("#SubMenuNameList").prop("disabled", false);
                }
                else
                {
                    $("#SubMenuNameList").prop("disabled", true)
                }
            });
            
        });
    </script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#btnReset").click(function myfunction() {
            location.reload();
        });
    });
</script>